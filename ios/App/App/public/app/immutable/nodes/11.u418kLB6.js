import{t as g,a as u,b as pe}from"../chunks/B1TZXfti.js";import"../chunks/VBNCskEB.js";import{p as xt,ac as ze,t as R,g as e,b as bt,e as i,c as n,d as F,m as c,r as l,n as Me,s}from"../chunks/CDb6m0PD.js";import{e as d,r as ht,s as A}from"../chunks/CxWVBdvW.js";import{i as x}from"../chunks/Dm4goCkW.js";import{e as Oe,i as Fe}from"../chunks/TA4SG1DG.js";import{a as He,r as K,s as kt}from"../chunks/CK-3OmJg.js";import{s as H}from"../chunks/BqtZpFwS.js";import{b as _e}from"../chunks/DMjQQS0d.js";import{i as yt}from"../chunks/CGS7UL4d.js";import{s as Rt,a as Tt}from"../chunks/CbuS4uut.js";import{o as Dt}from"../chunks/BOa5fj8P.js";import{g as Ve}from"../chunks/DXN4q5X4.js";import{a as St}from"../chunks/3OU4Vcau.js";import{D as Et,i as Lt,d as Be}from"../chunks/Cefqs-SS.js";import{e as Ct,f as It,h as At}from"../chunks/BERqu7mZ.js";var Pt=g("<button> </button>"),Ut=g("<button> </button>"),zt=g('<input type="datetime-local" class="svelte-k8wt4x">'),Mt=g('<button class="record-button svelte-k8wt4x">Start Recording</button>'),Ot=g('<div class="recording-indicator svelte-k8wt4x"><span class="recording-pulse svelte-k8wt4x"></span> </div> <button class="stop-button svelte-k8wt4x">Stop Recording</button>',1),Ft=g('<button class="analyze-button svelte-k8wt4x">Analyze Voice Tone</button>'),Ht=g('<div class="analyzing svelte-k8wt4x">Analyzing voice tone...</div>'),Vt=g('<div class="voice-insight svelte-k8wt4x"><span class="svelte-k8wt4x">Detected tone: <strong class="svelte-k8wt4x"> </strong></span> <span class="svelte-k8wt4x"> </span></div>'),Bt=g('<div class="audio-player svelte-k8wt4x"><audio controls class="svelte-k8wt4x"></audio> <button class="delete-button svelte-k8wt4x">Delete Recording</button> <!></div>'),Gt=g('<div class="error-message svelte-k8wt4x"> </div>'),Wt=g(`<div class="reflect-container svelte-k8wt4x"><h1 class="svelte-k8wt4x">New Reflection</h1> <div class="form-section svelte-k8wt4x"><h2 class="svelte-k8wt4x">How are you feeling?</h2> <div class="mood-selector svelte-k8wt4x"><div class="mood-tabs svelte-k8wt4x"><button>High Vibes</button> <button>Neutral</button> <button>Low Vibes</button></div> <div class="mood-options svelte-k8wt4x"></div></div></div> <div class="form-section svelte-k8wt4x"><h2 class="svelte-k8wt4x">Describe your moment</h2> <textarea placeholder="What's happening in this moment? How do you feel?" rows="4" class="svelte-k8wt4x"></textarea></div> <div class="form-section svelte-k8wt4x"><h2 class="svelte-k8wt4x">Tags</h2> <div class="tags-container svelte-k8wt4x"></div> <div class="custom-tag svelte-k8wt4x"><input type="text" placeholder="Add custom tag" class="svelte-k8wt4x"> <button class="svelte-k8wt4x">Add</button></div></div> <div class="form-section svelte-k8wt4x"><h2 class="svelte-k8wt4x">When did this happen?</h2> <div class="timestamp-selector svelte-k8wt4x"><label class="svelte-k8wt4x"><input type="radio" class="svelte-k8wt4x"> Now</label> <label class="svelte-k8wt4x"><input type="radio" class="svelte-k8wt4x"> Choose time</label> <!></div></div> <div class="form-section svelte-k8wt4x"><h2 class="svelte-k8wt4x">Voice Log (Optional)</h2> <div class="voice-recorder svelte-k8wt4x"><!></div></div> <!> <button class="submit-button svelte-k8wt4x"><!></button></div> <!>`,1);function rs(Ge,We){xt(We,!1);const[Ne,je]=Rt(),P=()=>Tt(St,"$authStore",Ne),Q={high:["Joy","Appreciation","Empowerment","Freedom","Love","Passion","Enthusiasm","Eagerness","Happiness","Positive Expectation","Belief","Optimism","Hopefulness","Contentment"],neutral:["Boredom","Pessimism","Frustration","Irritation","Impatience","Overwhelm","Disappointment","Doubt","Worry"],low:["Blame","Discouragement","Anger","Revenge","Hatred","Rage","Jealousy","Insecurity","Guilt","Unworthiness","Fear","Grief","Depression","Despair","Powerlessness"]},Je=["Work","Family","Friends","Health","Relationship","Personal Growth","Finances","Creativity","Spirituality"];let m=c([]),T=c(""),f=c([]),b=c(""),V=c(new Date),D=c(!0),S=c(!1),E=null,X=[],h=c(null),p=c(null),B=c(0),L=null,_=c(null),G=c(!1),W=c(!1),U=c(!1),k=c(null),y=c("neutral");function qe(t){e(m).indexOf(t)===-1?s(m,[...e(m),t]):s(m,e(m).filter(o=>o!==t))}function Ke(t){e(f).indexOf(t)===-1?s(f,[...e(f),t]):s(f,e(f).filter(o=>o!==t))}function ge(){e(b)&&!e(f).includes(e(b))&&(s(f,[...e(f),e(b)]),s(b,""))}function we(){s(D,!e(D)),e(D)&&s(V,new Date)}async function Qe(){try{const t=await navigator.mediaDevices.getUserMedia({audio:!0});E=new MediaRecorder(t),X=[],E.addEventListener("dataavailable",a=>{X.push(a.data)}),E.addEventListener("stop",()=>{s(h,new Blob(X,{type:"audio/webm"})),s(p,URL.createObjectURL(e(h))),s(S,!1),L&&(clearInterval(L),L=null)}),E.start(),s(S,!0),s(B,0),L=setInterval(()=>{s(B,e(B)+1)},1e3)}catch(t){console.error("Error starting recording:",t),s(S,!1)}}function Xe(){E&&e(S)&&E.stop()}function Ye(t){const a=Math.floor(t/60),o=t%60;return`${a}:${o.toString().padStart(2,"0")}`}async function xe(){if(!(!e(h)||!e(p))){s(G,!0);try{const t=await At(e(p));t.success&&t.tone&&t.confidence&&s(_,{tone:t.tone,confidence:t.confidence})}catch(t){console.error("Error analyzing voice:",t)}finally{s(G,!1)}}}async function Ze(){if(P().user){if(e(m).length===0){s(k,"Please select at least one mood");return}if(!e(T).trim()){s(k,"Please enter a reflection");return}s(W,!0),s(k,null);try{let t="neutral";for(const r of e(m))if(Q.high.includes(r)){t="high";break}else if(Q.low.includes(r)){t="low";break}let a="";if(e(h)){const r=await Ct(P().user,e(h));r.success&&r.url&&(a=r.url,e(_)||await xe())}const o={timestamp:e(V).toISOString(),mood:e(m),mood_level:t,text:e(T),tags:e(f),...a&&{audio_url:a},...e(_)&&{voice_insight:e(_)}};if((await It(P().user,o)).success)if(s(U,!0),await Lt(P().user)){const v=Be.showRandomTool();v&&await Be.logToolInteraction(P().user,v.id,"shown"),setTimeout(()=>{s(m,[]),s(T,""),s(f,[]),s(b,""),s(h,null),s(p,null),s(_,null),s(U,!1)},2e3)}else setTimeout(()=>{s(m,[]),s(T,""),s(f,[]),s(b,""),s(h,null),s(p,null),s(_,null),s(U,!1),Ve("/history")},2e3);else s(k,"Failed to save reflection. Please try again.")}catch(t){console.error("Error submitting reflection:",t),s(k,"An unexpected error occurred. Please try again.")}finally{s(W,!1)}}}Dt(()=>()=>{e(p)&&URL.revokeObjectURL(e(p)),L&&clearInterval(L)}),yt();var be=Wt(),Y=ze(be),Z=i(n(Y),2),he=i(n(Z),2),$=n(he),ee=n($);let ke;var te=i(ee,2);let ye;var Re=i(te,2);let Te;l($);var De=i($,2);Oe(De,5,()=>Q[e(y)],Fe,(t,a)=>{var o=Pt();let w;var r=n(o,!0);l(o),R(v=>{w=H(o,1,"mood-chip svelte-k8wt4x",null,w,v),A(r,e(a))},[()=>({selected:e(m).includes(e(a))})],F),d("click",o,()=>qe(e(a))),u(t,o)}),l(De),l(he),l(Z);var se=i(Z,2),Se=i(n(se),2);ht(Se),l(se);var ae=i(se,2),oe=i(n(ae),2);Oe(oe,5,()=>Je,Fe,(t,a)=>{var o=Ut();let w;var r=n(o,!0);l(o),R(v=>{w=H(o,1,"tag-chip svelte-k8wt4x",null,w,v),A(r,e(a))},[()=>({selected:e(f).includes(e(a))})],F),d("click",o,()=>Ke(e(a))),u(t,o)}),l(oe);var Ee=i(oe,2),N=n(Ee);K(N);var $e=i(N,2);l(Ee),l(ae);var ie=i(ae,2),Le=i(n(ie),2),re=n(Le),le=n(re);K(le),Me(),l(re);var ne=i(re,2),ce=n(ne);K(ce),Me(),l(ne);var et=i(ne,2);{var tt=t=>{var a=zt();K(a),_e(a,()=>e(V),o=>s(V,o)),u(t,a)};x(et,t=>{e(D)||t(tt)})}l(Le),l(ie);var ve=i(ie,2),Ce=i(n(ve),2),st=n(Ce);{var at=t=>{var a=Mt();d("click",a,Qe),u(t,a)},ot=(t,a)=>{{var o=r=>{var v=Ot(),z=ze(v),M=i(n(z));l(z);var O=i(z,2);R(J=>A(M,` Recording... ${J??""}`),[()=>Ye(e(B))],F),d("click",O,Xe),u(r,v)},w=(r,v)=>{{var z=M=>{var O=Bt(),J=n(O),Ae=i(J,2),vt=i(Ae,2);{var ut=C=>{var q=Ft();d("click",q,xe),u(C,q)},dt=(C,q)=>{{var ft=I=>{var ue=Ht();u(I,ue)},mt=(I,ue)=>{{var pt=de=>{var fe=Vt(),me=n(fe),Pe=i(n(me)),_t=n(Pe,!0);l(Pe),l(me);var Ue=i(me,2),gt=n(Ue);l(Ue),l(fe),R(wt=>{A(_t,e(_).tone),A(gt,`Confidence: ${wt??""}%`)},[()=>Math.round(e(_).confidence*100)],F),u(de,fe)};x(I,de=>{e(_)&&de(pt)},ue)}};x(C,I=>{e(G)?I(ft):I(mt,!1)},q)}};x(vt,C=>{!e(_)&&!e(G)?C(ut):C(dt,!1)})}l(O),R(()=>kt(J,"src",e(p))),d("click",Ae,()=>{s(p,null),s(h,null),s(_,null)}),u(M,O)};x(r,M=>{e(p)&&M(z)},v)}};x(t,r=>{e(S)?r(o):r(w,!1)},a)}};x(st,t=>{!e(S)&&!e(p)?t(at):t(ot,!1)})}l(Ce),l(ve);var Ie=i(ve,2);{var it=t=>{var a=Gt(),o=n(a,!0);l(a),R(()=>A(o,e(k))),u(t,a)};x(Ie,t=>{e(k)&&t(it)})}var j=i(Ie,2),rt=n(j);{var lt=t=>{var a=pe("Saving...");u(t,a)},nt=(t,a)=>{{var o=r=>{var v=pe("Saved!");u(r,v)},w=r=>{var v=pe("Log Reflection");u(r,v)};x(t,r=>{e(U)?r(o):r(w,!1)},a)}};x(rt,t=>{e(W)?t(lt):t(nt,!1)})}l(j),l(Y);var ct=i(Y,2);Et(ct,{onClose:()=>Ve("/history")}),R((t,a,o)=>{ke=H(ee,1,"svelte-k8wt4x",null,ke,t),ye=H(te,1,"svelte-k8wt4x",null,ye,a),Te=H(Re,1,"svelte-k8wt4x",null,Te,o),He(le,e(D)),He(ce,!e(D)),j.disabled=e(W)||e(U)},[()=>({active:e(y)==="high"}),()=>({active:e(y)==="neutral"}),()=>({active:e(y)==="low"})],F),d("click",ee,()=>s(y,"high")),d("click",te,()=>s(y,"neutral")),d("click",Re,()=>s(y,"low")),_e(Se,()=>e(T),t=>s(T,t)),_e(N,()=>e(b),t=>s(b,t)),d("keydown",N,t=>t.key==="Enter"&&ge()),d("click",$e,ge),d("change",le,we),d("change",ce,we),d("click",j,Ze),u(Ge,be),bt(),je()}export{rs as component};
