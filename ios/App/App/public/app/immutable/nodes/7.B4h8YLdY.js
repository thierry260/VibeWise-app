import{t as m,a as h}from"../chunks/DwZKRegf.js";import"../chunks/B4OBRiys.js";import{p as Le,a as $e,c as a,s as v,m as R,g as e,r as i,b as o,t as W,n as J,y as x,f as je}from"../chunks/BfLd7xIT.js";import{e as k,s as d}from"../chunks/D2q-kWfj.js";import{i as M}from"../chunks/CNGqELc8.js";import{b as Ae}from"../chunks/DoWAKkCU.js";import{i as Ge}from"../chunks/DsaIGbBj.js";import{s as Pe,a as te}from"../chunks/Dfb5LgfT.js";import{o as Ye}from"../chunks/BtKD0jUe.js";import{p as Ne}from"../chunks/DgX6owf5.js";import{g as se}from"../chunks/CRbbwQ-c.js";import{a as Oe}from"../chunks/DuaF19nW.js";import{b as Ue}from"../chunks/CESdso1d.js";import{u as qe,M as E,g as We}from"../chunks/DxhWQ7yC.js";var Je=m('<div class="loading svelte-tbzlpy">Loading session details...</div>'),Ke=m('<div class="error-message svelte-tbzlpy"> </div>'),Qe=m('<div class="interpretation-text svelte-tbzlpy">No score available</div>'),Xe=m('<div class="interpretation-emoji"> </div> <div class="interpretation-text svelte-tbzlpy"> </div>',1),Ze=m('<div class="session-info svelte-tbzlpy"><div class="session-header svelte-tbzlpy"><div class="session-date svelte-tbzlpy"> </div> <div class="session-time svelte-tbzlpy"> </div></div> <div class="metrics-grid svelte-tbzlpy"><button class="metric-tile svelte-tbzlpy" aria-label="Heart Rate Information"><h3 class="svelte-tbzlpy">Heart Rate</h3> <p class="value svelte-tbzlpy"> <span class="unit svelte-tbzlpy">BPM</span></p> <!></button> <button class="metric-tile svelte-tbzlpy" aria-label="Balance Information"><h3 class="svelte-tbzlpy">Balance</h3> <p class="value svelte-tbzlpy"> <span class="unit svelte-tbzlpy">ms</span></p> <!></button> <button class="metric-tile svelte-tbzlpy" aria-label="Session Time Information"><h3 class="svelte-tbzlpy">Duration</h3> <p class="value svelte-tbzlpy"> </p> <!></button> <button class="metric-tile vibe-tile svelte-tbzlpy" aria-label="Vibe Score Information"><h3 class="svelte-tbzlpy">Vibe Score</h3> <p class="value svelte-tbzlpy"> </p> <div class="vibe-interpretation svelte-tbzlpy"><!></div> <!></button></div> <div class="chart-section svelte-tbzlpy"><h2 class="svelte-tbzlpy">Session Data</h2> <div class="chart-container svelte-tbzlpy"></div> <div class="unified-legend svelte-tbzlpy"><div class="legend-item svelte-tbzlpy"><div class="legend-dot hr-dot svelte-tbzlpy"></div> <span class="legend-label svelte-tbzlpy">Heart Rate</span></div> <div class="legend-item svelte-tbzlpy"><div class="legend-dot rmssd-dot svelte-tbzlpy"></div> <span class="legend-label svelte-tbzlpy">Balance</span></div> <div class="legend-item svelte-tbzlpy"><div class="legend-dot vibe-dot svelte-tbzlpy"></div> <span class="legend-label svelte-tbzlpy">Vibe Score</span></div></div></div></div>'),et=m('<div class="error-message svelte-tbzlpy">Session not found</div>'),tt=m('<div class="hrv-detail-container svelte-tbzlpy"><div class="header svelte-tbzlpy"><button class="back-button svelte-tbzlpy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-tbzlpy"><path d="M19 12H5M12 19l-7-7 7-7"></path></svg> Back</button></div> <!></div>');function ht(ae,ie){Le(ie,!1);const[K,re]=Pe(),Q=()=>te(Oe,"$authStore",K),oe=()=>te(Ne,"$page",K);let c=R(null),F=R(!0),w=R(null),g=R(),f=null,u=R(null);const s={heartRate:{title:"Heart Rate",explanation:"Your heart rate is the number of times your heart beats per minute.",hint:"A lower resting heart rate often indicates better cardiovascular fitness.",stateDescription:"Your heart rate changes throughout the day based on activity, emotions, and rest.",suggestion:"Deep, slow breathing can help lower your heart rate when it is elevated."},balance:{title:"Balance (RMSSD)",explanation:"Balance measures the variation between heartbeats, indicating how your nervous system is responding.",hint:"Higher values typically suggest better recovery and resilience.",stateDescription:"This metric reflects the balance between your sympathetic (action) and parasympathetic (rest) systems.",suggestion:"Regular relaxation practices can help improve your balance over time."},vibeScore:{title:"Vibe Score",explanation:"Your Vibe Score combines multiple HRV metrics into one easy-to-understand number.",hint:"Higher scores indicate a more balanced physiological state.",stateDescription:"This score reflects your overall physiological balance at the time of measurement.",suggestion:"Regular sessions can help you understand what activities improve your score."},time:{title:"Session Duration",explanation:"The total time you spent in this HRV measurement session.",hint:"Even short sessions can provide valuable insights.",stateDescription:"Longer sessions may reveal patterns in how your body responds over time.",suggestion:"Aim for at least 5 minutes for the most reliable readings."}};function V(t){e(u)===t?v(u,null):v(u,t)}Ye(async()=>{if(!Q().user){se("/login");return}const t=oe().url.searchParams.get("id");if(!t){v(w,"No session ID provided."),v(F,!1);return}try{const n=await Ue(Q().user,t);n.success&&n.session&&n.session.type==="hrv_session"?(v(c,n.session),setTimeout(()=>{e(g)&&e(c)&&ne()},100)):v(w,"Failed to load HRV session or session not found.")}catch(n){console.error("Error loading HRV session:",n),v(w,"An unexpected error occurred while loading the session.")}finally{v(F,!1)}});function ne(){if(!e(g)||!e(c)){console.error("Chart element or session data not found");return}const t=[],n=[],y=[],H=[];e(c).chart_data.forEach(r=>{const l=new Date(r.timestamp).getTime()/1e3;t.push(l),n.push(r.hr),y.push(r.rmssd),H.push(r.vibe)});const b={width:e(g).clientWidth,height:300,padding:[20,0,0,0],cursor:{show:!0,points:{show:!1},drag:{setScale:!1},focus:{prox:30}},legend:{show:!1},series:[{},{scale:"hr",label:"Heart Rate",value:(r,l)=>l==null?"-":l.toFixed(0)+" bpm",stroke:"rgba(229, 57, 53, 0.8)",width:2,points:{show:!1},spanGaps:!0},{scale:"rmssd",label:"Balance",value:(r,l)=>l==null?"-":l.toFixed(1)+" ms",stroke:"rgba(77, 68, 179, 0.8)",width:2,points:{show:!1},spanGaps:!0},{scale:"vibe",label:"Vibe Score",value:(r,l)=>l==null?"-":l.toFixed(0),stroke:"rgba(191, 70, 154, 0.8)",width:2,points:{show:!1},spanGaps:!0}],scales:{x:{time:!0},hr:{auto:!0,range:[40,180]},rmssd:{auto:!0,range:[0,100]},vibe:{auto:!0,range:[0,100]}},axes:[{},{}]};try{f=new qe(b,[t,n,y,H],e(g));const r=new ResizeObserver(l=>{f&&l[0]&&f.setSize({width:l[0].contentRect.width,height:300})});return r.observe(e(g)),()=>{f&&(f.destroy(),f=null),r.disconnect()}}catch(r){console.error("Error creating chart:",r)}}function le(t){return new Date(t).toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric",year:"numeric"})}function ce(t){return new Date(t).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}function ve(t){const n=Math.floor(t/60),y=t%60;return`${n}:${y.toString().padStart(2,"0")}`}function ue(){se("/history")}Ge();var L=tt(),$=a(L),pe=a($);i($);var de=o($,2);{var be=t=>{var n=Je();h(t,n)},ge=(t,n)=>{{var y=b=>{var r=Ke(),l=a(r,!0);i(r),W(()=>d(l,e(w))),h(b,r)},H=(b,r)=>{{var l=_=>{var S=Ze(),j=a(S),A=a(j),me=a(A,!0);i(A);var X=o(A,2),fe=a(X,!0);i(X),i(j);var G=o(j,2),B=a(G),P=o(a(B),2),ye=a(P);J(),i(P);var _e=o(P,2);const ze=x(()=>e(u)==="heartRate");E(_e,{get isVisible(){return e(ze)},onClose:()=>v(u,null),get title(){return s.heartRate.title},get explanation(){return s.heartRate.explanation},get hint(){return s.heartRate.hint},get stateDescription(){return s.heartRate.stateDescription},get suggestion(){return s.heartRate.suggestion}}),i(B);var T=o(B,2),Y=o(a(T),2),xe=a(Y);J(),i(Y);var we=o(Y,2);const Se=x(()=>e(u)==="balance");E(we,{get isVisible(){return e(Se)},onClose:()=>v(u,null),get title(){return s.balance.title},get explanation(){return s.balance.explanation},get hint(){return s.balance.hint},get stateDescription(){return s.balance.stateDescription},get suggestion(){return s.balance.suggestion}}),i(T);var C=o(T,2),N=o(a(C),2),De=a(N,!0);i(N);var Re=o(N,2);const ke=x(()=>e(u)==="time");E(Re,{get isVisible(){return e(ke)},onClose:()=>v(u,null),get title(){return s.time.title},get explanation(){return s.time.explanation},get hint(){return s.time.hint},get stateDescription(){return s.time.stateDescription},get suggestion(){return s.time.suggestion}}),i(C);var O=o(C,2),U=o(a(O),2),Ve=a(U,!0);i(U);var q=o(U,2),He=a(q);{var Be=p=>{var z=Qe();h(p,z)},Te=p=>{var z=Xe();const I=x(()=>We(e(c).vibe_score));var D=je(z),Ee=a(D,!0);i(D);var ee=o(D,2),Fe=a(ee,!0);i(ee),W(()=>{d(Ee,e(I).emoji),d(Fe,e(I).label)}),h(p,z)};M(He,p=>{e(c).vibe_score?p(Te,!1):p(Be)})}i(q);var Ce=o(q,2);const Ie=x(()=>e(u)==="vibeScore");E(Ce,{get isVisible(){return e(Ie)},onClose:()=>v(u,null),get title(){return s.vibeScore.title},get explanation(){return s.vibeScore.explanation},get hint(){return s.vibeScore.hint},get stateDescription(){return s.vibeScore.stateDescription},get suggestion(){return s.vibeScore.suggestion}}),i(O),i(G);var Z=o(G,2),Me=o(a(Z),2);Ae(Me,p=>v(g,p),()=>e(g)),J(2),i(Z),i(S),W((p,z,I,D)=>{d(me,p),d(fe,z),d(ye,`${e(c).avg_hr??""} `),d(xe,`${I??""} `),d(De,D),d(Ve,e(c).vibe_score)},[()=>le(e(c).timestamp),()=>ce(e(c).timestamp),()=>e(c).avg_rmssd.toFixed(1),()=>ve(e(c).duration_seconds)],x),k("click",B,()=>V("heartRate")),k("click",T,()=>V("balance")),k("click",C,()=>V("time")),k("click",O,()=>V("vibeScore")),h(_,S)},he=_=>{var S=et();h(_,S)};M(b,_=>{e(c)?_(l):_(he,!1)},r)}};M(t,b=>{e(w)?b(y):b(H,!1)},n)}};M(de,t=>{e(F)?t(be):t(ge,!1)})}i(L),k("click",pe,ue),h(ae,L),$e(),re()}export{ht as component};
