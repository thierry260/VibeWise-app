import{t as c,a as l}from"../chunks/CN_4Jffs.js";import"../chunks/C_EceCEL.js";import{p as Se,b as we,s as A,m as F,g as e,an as ee,e as u,c as r,r as s,t as D,d as J}from"../chunks/C32UjKbq.js";import{s as v,e as P}from"../chunks/HXctbdJI.js";import{i as f}from"../chunks/CdUhBWiK.js";import{e as ke,i as Ie}from"../chunks/BeeDwF9Y.js";import{s as $e}from"../chunks/B5wR7jRG.js";import{s as te}from"../chunks/Bfc47y5P.js";import{i as Be}from"../chunks/BT-A8O5u.js";import{s as Ee,a as Re}from"../chunks/D2OzG1jj.js";import{o as De}from"../chunks/D1wvVs1Z.js";import{g as U}from"../chunks/C028ppxN.js";import{a as He}from"../chunks/DxcAzl92.js";import{b as Ve,a as Le}from"../chunks/L29Sq4FH.js";var Te=c('<div class="loading svelte-y7ghsq">Loading your sessions...</div>'),Ae=c('<div class="error-message svelte-y7ghsq"> </div>'),Fe=c(`<div class="empty-state svelte-y7ghsq"><p>You haven't created any sessions yet.</p> <p>Start by creating a reflection or HRV session!</p></div>`),Pe=c('<button class="add-balcony-button svelte-y7ghsq">Add Balcony Insight</button>'),Ue=c('<div class="has-balcony svelte-y7ghsq"><span class="balcony-badge svelte-y7ghsq">Has Balcony Insight</span> <button class="view-balcony-button svelte-y7ghsq">View/Edit</button></div>'),je=c('<div class="session-content svelte-y7ghsq"><p class="mood svelte-y7ghsq"> </p> <p class="text-preview svelte-y7ghsq"> </p> <!></div>'),Ce=c('<div class="session-content svelte-y7ghsq"><p class="hrv-stats svelte-y7ghsq"><span> </span> <span> </span></p></div>'),Me=c('<div class="session-content svelte-y7ghsq"><p class="balcony-pattern svelte-y7ghsq"> </p> <p class="balcony-truth svelte-y7ghsq"> </p></div>'),Ne=c('<div class="session-card svelte-y7ghsq" tabindex="0" role="button"><div class="session-icon svelte-y7ghsq"> </div> <div class="session-details svelte-y7ghsq"><div class="session-header svelte-y7ghsq"><span class="session-type svelte-y7ghsq"> </span> <span class="session-time svelte-y7ghsq"> </span></div> <div class="session-date svelte-y7ghsq"> </div> <!></div></div>'),Ye=c('<div class="sessions-list svelte-y7ghsq"></div>'),ze=c('<div class="history-container svelte-y7ghsq"><h1 class="svelte-y7ghsq">Session History</h1> <!></div>');function it(ae,se){Se(se,!1);const[re,oe]=Ee(),H=()=>Re(He,"$authStore",re);let V=F([]),K=F(!0),L=F(null),b=F({});De(async()=>{if(H().user)try{const t=await Ve(H().user,20);t.success&&t.sessions?(A(V,t.sessions),await ie()):A(L,"Failed to load recent sessions.")}catch(t){console.error("Error loading sessions:",t),A(L,"An unexpected error occurred while loading sessions.")}finally{A(K,!1)}});async function ie(){if(!H().user)return;const t=e(V).filter(i=>i.type==="reflection").map(i=>i.id);for(const i of t)try{const k=await Le(H().user,i);ee(b,e(b)[i]=k.success)}catch(k){console.error(`Error checking balcony for reflection ${i}:`,k),ee(b,e(b)[i]=!1)}}function O(t){t.type==="reflection"?U(`/reflection/${t.id}`):t.type==="hrv_session"?U(`/hrv-detail?id=${t.id}`):t.type==="balcony"&&U(`/balcony?reflectionId=${t.parent_reflection_id}`)}function Q(t){U(`/balcony?reflectionId=${t}`)}function ne(t){return new Date(t).toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric",year:"numeric"})}function le(t){return new Date(t).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}function ve(t){switch(t){case"reflection":return"ðŸ–Šï¸";case"hrv_session":return"ðŸ“ˆ";case"balcony":return"ðŸ§ ";default:return"ðŸ“"}}function W(t){switch(t){case"reflection":return"Reflection";case"hrv_session":return"HRV Session";case"balcony":return"Balcony Experiment";default:return"Session"}}Be();var j=ze(),ce=u(r(j),2);{var de=t=>{var i=Te();l(t,i)},pe=(t,i)=>{{var k=q=>{var I=Ae(),C=r(I,!0);s(I),D(()=>v(C,e(L))),l(q,I)},ue=(q,I)=>{{var C=x=>{var $=Fe();l(x,$)},ye=x=>{var $=Ye();ke($,5,()=>e(V),Ie,(fe,a)=>{var S=Ne(),M=r(S),he=r(M,!0);s(M);var X=u(M,2),N=r(X),Y=r(N),ge=r(Y,!0);s(Y);var Z=u(Y,2),_e=r(Z,!0);s(Z),s(N);var z=u(N,2),me=r(z,!0);s(z);var be=u(z,2);{var qe=d=>{var h=je(),g=r(h),B=r(g,!0);s(g);var n=u(g,2),_=r(n);s(n);var w=u(n,2);{var y=o=>{var p=Pe();P("click",p,te(()=>Q(e(a).id))),l(o,p)},m=(o,p)=>{{var T=E=>{var R=Ue(),G=u(r(R),2);s(R),P("click",G,te(()=>Q(e(a).id))),l(E,R)};f(o,E=>{e(b)[e(a).id]===!0&&E(T)},p)}};f(w,o=>{e(b)[e(a).id]===!1?o(y):o(m,!1)})}s(h),D((o,p)=>{v(B,o),v(_,`${p??""}${e(a).text.length>100?"...":""}`)},[()=>e(a).mood.join(", "),()=>e(a).text.substring(0,100)],J),l(d,h)},xe=(d,h)=>{{var g=n=>{var _=Ce(),w=r(_),y=r(w),m=r(y);s(y);var o=u(y,2),p=r(o);s(o),s(w),s(_),D(()=>{v(m,`Avg HR: ${e(a).avg_hr??""} bpm`),v(p,`Vibe Score: ${e(a).vibe_score??""}`)}),l(n,_)},B=(n,_)=>{{var w=y=>{var m=Me(),o=r(m),p=r(o);s(o);var T=u(o,2),E=r(T);s(T),s(m),D((R,G)=>{v(p,`Pattern: ${R??""}${e(a).pattern.length>100?"...":""}`),v(E,`Truth: ${G??""}${e(a).truth.length>100?"...":""}`)},[()=>e(a).pattern.substring(0,100),()=>e(a).truth.substring(0,100)],J),l(y,m)};f(n,y=>{e(a).type==="balcony"&&y(w)},_)}};f(d,n=>{e(a).type==="hrv_session"?n(g):n(B,!1)},h)}};f(be,d=>{e(a).type==="reflection"?d(qe):d(xe,!1)})}s(X),s(S),D((d,h,g,B,n)=>{$e(S,"aria-label",d),v(he,h),v(ge,g),v(_e,B),v(me,n)},[()=>`View ${W(e(a).type)} details`,()=>ve(e(a).type),()=>W(e(a).type),()=>le(e(a).timestamp),()=>ne(e(a).timestamp)],J),P("click",S,()=>O(e(a))),P("keydown",S,d=>d.key==="Enter"&&O(e(a))),l(fe,S)}),s($),l(x,$)};f(q,x=>{e(V).length===0?x(C):x(ye,!1)},I)}};f(t,q=>{e(L)?q(k):q(ue,!1)},i)}};f(ce,t=>{e(K)?t(de):t(pe,!1)})}s(j),l(ae,j),we(),oe()}export{it as component};
