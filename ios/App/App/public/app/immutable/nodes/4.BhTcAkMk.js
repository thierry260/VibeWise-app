import{t as y,a as f,b as J}from"../chunks/DwZKRegf.js";import"../chunks/B4OBRiys.js";import{p as Me,f as oe,a as Re,c as i,s as a,m as p,g as e,r as s,b as n,t as _,y as Te}from"../chunks/BfLd7xIT.js";import{e as K,s as d,r as le}from"../chunks/D2q-kWfj.js";import{i as b}from"../chunks/CNGqELc8.js";import{e as Pe,i as Le}from"../chunks/D2bNO8Ei.js";import{b as ne}from"../chunks/ruYCseK5.js";import{i as Fe}from"../chunks/DsaIGbBj.js";import{s as Ue,a as ce}from"../chunks/Dfb5LgfT.js";import{o as Ae}from"../chunks/BtKD0jUe.js";import{p as He}from"../chunks/DgX6owf5.js";import{g as Q}from"../chunks/CRbbwQ-c.js";import{a as Oe}from"../chunks/DuaF19nW.js";import{g as We,a as Ye,u as qe,c as ze}from"../chunks/CESdso1d.js";var Ce=y('<div class="loading svelte-3p1kfj">Loading reflection data...</div>'),Ne=y('<div class="error-card svelte-3p1kfj"><h2 class="svelte-3p1kfj">Error</h2> <p> </p> <button class="svelte-3p1kfj">Return Home</button></div>'),Ge=y('<span class="tag svelte-3p1kfj"> </span>'),Je=y('<div class="tags svelte-3p1kfj"></div>'),Ke=y('<div class="error-message svelte-3p1kfj"> </div>'),Qe=y('<div class="original-reflection svelte-3p1kfj"><h2 class="svelte-3p1kfj">Original Reflection</h2> <div class="reflection-card svelte-3p1kfj"><div class="reflection-header svelte-3p1kfj"><span class="timestamp svelte-3p1kfj"> </span> <span class="mood-tag svelte-3p1kfj"> </span></div> <p class="reflection-text svelte-3p1kfj"> </p> <!></div> <div class="time-difference svelte-3p1kfj"><span> </span></div></div> <div class="form-section svelte-3p1kfj"><h2 class="svelte-3p1kfj">What pattern or limiting belief did you notice?</h2> <textarea placeholder="Describe the pattern or limiting belief you observed in yourself..." rows="3" class="svelte-3p1kfj"></textarea></div> <div class="form-section svelte-3p1kfj"><h2 class="svelte-3p1kfj">What insight or truth did you discover when you zoomed out?</h2> <textarea placeholder="Share the honest truth or insight you gained with perspective..." rows="3" class="svelte-3p1kfj"></textarea></div> <!> <button class="submit-button svelte-3p1kfj"><!></button>',1),Ve=y('<div class="header"><button class="back-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5M12 19l-7-7 7-7"></path></svg> Back</button></div> <div class="balcony-container svelte-3p1kfj"><!></div>',1);function pt(ve,fe){Me(fe,!1);const[V,pe]=Ue(),de=()=>ce(He,"$page",V),k=()=>ce(Oe,"$authStore",V);let c=p(null),x=null,j=p(null),T=p(!0),w=null,B=p(!1),S=p(""),$=p(""),E=p(0),P=p(!1),U=p(!1),u=p(null);Ae(async()=>{if(x=de().url.searchParams.get("reflectionId"),!x){a(j,"No reflection ID provided. Balcony experiments must be linked to a reflection."),a(T,!1);return}if(!k().user){a(j,"You must be logged in to create a balcony experiment."),a(T,!1);return}try{const t=await We(k().user,x);if(t.success&&t.reflection){a(c,t.reflection);const o=await Ye(k().user,x);if(o.success&&o.balcony)w=o.balcony,a(B,!0),a(S,w.pattern),a($,w.truth),a(E,w.delay_minutes);else{const m=new Date(e(c).timestamp).getTime(),H=new Date().getTime();a(E,Math.floor((H-m)/(1e3*60)))}}else a(j,"Failed to load reflection. It may have been deleted.")}catch(t){console.error("Error loading reflection:",t),a(j,"An error occurred while loading the reflection.")}finally{a(T,!1)}});function ue(t){if(t<60)return`${t} minute${t!==1?"s":""}`;const o=Math.floor(t/60),m=t%60;return m===0?`${o} hour${o!==1?"s":""}`:`${o} hour${o!==1?"s":""} and ${m} minute${m!==1?"s":""}`}async function me(){if(!(!k().user||!x||!e(c))){if(!e(S).trim()){a(u,"Please enter a limiting belief or pattern");return}if(!e($).trim()){a(u,"Please enter your honest truth or insight");return}a(P,!0),a(u,null);try{let t;if(e(B)&&w){const o={pattern:e(S).trim(),truth:e($).trim(),delay_minutes:e(E)};t=await qe(k().user,w.id,o)}else{const o={timestamp:new Date().toISOString(),parent_reflection_id:x,pattern:e(S).trim(),truth:e($).trim(),delay_minutes:e(E)};t=await ze(k().user,o)}t.success?(a(U,!0),setTimeout(()=>{Q("/history")},2e3)):a(u,`Failed to ${e(B)?"update":"save"} balcony experiment. Please try again.`)}catch(t){console.error("Error submitting balcony experiment:",t),a(u,"An unexpected error occurred. Please try again.")}finally{a(P,!1)}}}function he(){Q("/history")}Fe();var X=Ve(),A=oe(X),ge=i(A);s(A);var Z=n(A,2),_e=i(Z);{var be=t=>{var o=Ce();f(t,o)},ye=(t,o)=>{{var m=D=>{var I=Ne(),M=n(i(I),2),R=i(M,!0);s(M);var L=n(M,2);s(I),_(()=>d(R,e(j))),K("click",L,()=>Q("/home")),f(D,I)},H=(D,I)=>{{var M=R=>{var L=Qe(),O=oe(L),W=n(i(O),2),Y=i(W),q=i(Y),ke=i(q,!0);s(q);var ee=n(q,2),xe=i(ee,!0);s(ee),s(Y);var z=n(Y,2),je=i(z,!0);s(z);var we=n(z,2);{var Be=r=>{var l=Je();Pe(l,5,()=>e(c).tags,Le,(h,G)=>{var v=Ge(),g=i(v,!0);s(v),_(()=>d(g,e(G))),f(h,v)}),s(l),f(r,l)};b(we,r=>{e(c).tags&&e(c).tags.length>0&&r(Be)})}s(W);var te=n(W,2),ae=i(te),Se=i(ae);s(ae),s(te),s(O);var C=n(O,2),re=n(i(C),2);le(re),s(C);var N=n(C,2),se=n(i(N),2);le(se),s(N);var ie=n(N,2);{var $e=r=>{var l=Ke(),h=i(l,!0);s(l),_(()=>d(h,e(u))),f(r,l)};b(ie,r=>{e(u)&&r($e)})}var F=n(ie,2),De=i(F);{var Ee=r=>{var l=J();_(()=>d(l,e(B)?"Updating...":"Saving...")),f(r,l)},Ie=(r,l)=>{{var h=v=>{var g=J();_(()=>d(g,e(B)?"Updated!":"Saved!")),f(v,g)},G=v=>{var g=J();_(()=>d(g,e(B)?"Update Balcony Insight":"Save Balcony Insight")),f(v,g)};b(r,v=>{e(U)?v(h):v(G,!1)},l)}};b(De,r=>{e(P)?r(Ee):r(Ie,!1)})}s(F),_((r,l,h)=>{d(ke,r),d(xe,l),d(je,e(c).text),d(Se,`You gained this insight after ${h??""}.`),F.disabled=e(P)||e(U)},[()=>new Date(e(c).timestamp).toLocaleString(),()=>e(c).mood.join(", "),()=>ue(e(E))],Te),ne(re,()=>e(S),r=>a(S,r)),ne(se,()=>e($),r=>a($,r)),K("click",F,me),f(R,L)};b(D,R=>{e(c)&&R(M)},I)}};b(t,D=>{e(j)?D(m):D(H,!1)},o)}};b(_e,t=>{e(T)?t(be):t(ye,!1)})}s(Z),K("click",ge,he),f(ve,X),Re(),pe()}export{pt as component};
