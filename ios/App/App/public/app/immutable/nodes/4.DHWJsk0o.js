import{t as _,a as f,b as C}from"../chunks/CBOLqkOR.js";import{i as Se}from"../chunks/DYliPJ25.js";import{p as we,o as $e,b as De,s as r,m as d,g as e,e as o,c as i,r as s,t as P,a3 as Ee,d as Ie}from"../chunks/Gd2MJtJw.js";import{s as h,e as Z,r as ee}from"../chunks/6F2tKI9t.js";import{i as g}from"../chunks/DEjGzwbK.js";import{e as Be,i as Te}from"../chunks/DyHPtUt5.js";import{b as te}from"../chunks/DGJhUISI.js";import{s as Me,a as ae}from"../chunks/7oYGK_Th.js";import{p as Pe}from"../chunks/XRhlXrKY.js";import{g as re}from"../chunks/odb1_Vw7.js";import{a as Re}from"../chunks/BPWvYGMB.js";import{g as ke,c as Le}from"../chunks/x9z02Rao.js";var Ae=_('<div class="loading svelte-q3fqj7">Loading reflection data...</div>'),Fe=_('<div class="error-card svelte-q3fqj7"><h2 class="svelte-q3fqj7">Error</h2> <p> </p> <button class="svelte-q3fqj7">Return Home</button></div>'),Oe=_('<span class="tag svelte-q3fqj7"> </span>'),We=_('<div class="tags svelte-q3fqj7"></div>'),Ye=_('<div class="error-message svelte-q3fqj7"> </div>'),ze=_('<div class="original-reflection svelte-q3fqj7"><h2 class="svelte-q3fqj7">Original Reflection</h2> <div class="reflection-card svelte-q3fqj7"><div class="reflection-header svelte-q3fqj7"><span class="timestamp svelte-q3fqj7"> </span> <span class="mood-tag svelte-q3fqj7"> </span></div> <p class="reflection-text svelte-q3fqj7"> </p> <!></div> <div class="time-difference svelte-q3fqj7"><span> </span></div></div> <div class="form-section svelte-q3fqj7"><h2 class="svelte-q3fqj7">What pattern or limiting belief did you notice?</h2> <textarea placeholder="Describe the pattern or limiting belief you observed in yourself..." rows="3" class="svelte-q3fqj7"></textarea></div> <div class="form-section svelte-q3fqj7"><h2 class="svelte-q3fqj7">What insight or truth did you discover when you zoomed out?</h2> <textarea placeholder="Share the honest truth or insight you gained with perspective..." rows="3" class="svelte-q3fqj7"></textarea></div> <!> <button class="submit-button svelte-q3fqj7"><!></button>',1),He=_('<div class="balcony-container svelte-q3fqj7"><h1 class="svelte-q3fqj7">Balcony Experiment</h1> <!></div>');function at(se,ie){we(ie,!1);const[G,oe]=Me(),le=()=>ae(Pe,"$page",G),$=()=>ae(Re,"$authStore",G);let v=d(null),x=null,q=d(null),D=d(!0),E=d(""),I=d(""),R=d(0),B=d(!1),k=d(!1),u=d(null);$e(async()=>{if(x=le().url.searchParams.get("reflectionId"),!x){r(q,"No reflection ID provided. Balcony experiments must be linked to a reflection."),r(D,!1);return}if(!$().user){r(q,"You must be logged in to create a balcony experiment."),r(D,!1);return}try{const t=await ke($().user,x);if(t.success&&t.reflection){r(v,t.reflection);const n=new Date(e(v).timestamp).getTime(),m=new Date().getTime();r(R,Math.floor((m-n)/(1e3*60)))}else r(q,"Failed to load reflection. It may have been deleted.")}catch(t){console.error("Error loading reflection:",t),r(q,"An error occurred while loading the reflection.")}finally{r(D,!1)}});function ne(t){if(t<60)return`${t} minute${t!==1?"s":""}`;const n=Math.floor(t/60),m=t%60;return m===0?`${n} hour${n!==1?"s":""}`:`${n} hour${n!==1?"s":""} and ${m} minute${m!==1?"s":""}`}async function ve(){if(!(!$().user||!x||!e(v))){if(!e(E).trim()){r(u,"Please enter a limiting belief or pattern");return}if(!e(I).trim()){r(u,"Please enter your honest truth or insight");return}r(B,!0),r(u,null);try{const t={timestamp:new Date().toISOString(),parent_reflection_id:x,pattern:e(E).trim(),truth:e(I).trim(),delay_minutes:e(R)};(await Le($().user,t)).success?(r(k,!0),setTimeout(()=>{re("/home")},2e3)):r(u,"Failed to save balcony experiment. Please try again.")}catch(t){console.error("Error submitting balcony experiment:",t),r(u,"An unexpected error occurred. Please try again.")}finally{r(B,!1)}}}Se();var L=He(),ce=o(i(L),2);{var fe=t=>{var n=Ae();f(t,n)},de=(t,n)=>{{var m=b=>{var y=Fe(),j=o(i(y),2),S=i(j,!0);s(j);var T=o(j,2);s(y),P(()=>h(S,e(q))),Z("click",T,()=>re("/home")),f(b,y)},ue=(b,y)=>{{var j=S=>{var T=ze(),A=Ee(T),F=o(i(A),2),O=i(F),W=i(O),me=i(W,!0);s(W);var J=o(W,2),pe=i(J,!0);s(J),s(O);var Y=o(O,2),he=i(Y,!0);s(Y);var ge=o(Y,2);{var _e=a=>{var l=We();Be(l,5,()=>e(v).tags,Te,(p,N)=>{var c=Oe(),w=i(c,!0);s(c),P(()=>h(w,e(N))),f(p,c)}),s(l),f(a,l)};g(ge,a=>{e(v).tags&&e(v).tags.length>0&&a(_e)})}s(F);var K=o(F,2),Q=i(K),qe=i(Q);s(Q),s(K),s(A);var z=o(A,2),U=o(i(z),2);ee(U),s(z);var H=o(z,2),V=o(i(H),2);ee(V),s(H);var X=o(H,2);{var be=a=>{var l=Ye(),p=i(l,!0);s(l),P(()=>h(p,e(u))),f(a,l)};g(X,a=>{e(u)&&a(be)})}var M=o(X,2),xe=i(M);{var ye=a=>{var l=C("Saving...");f(a,l)},je=(a,l)=>{{var p=c=>{var w=C("Saved!");f(c,w)},N=c=>{var w=C("Save Balcony Insight");f(c,w)};g(a,c=>{e(k)?c(p):c(N,!1)},l)}};g(xe,a=>{e(B)?a(ye):a(je,!1)})}s(M),P((a,l,p)=>{h(me,a),h(pe,l),h(he,e(v).text),h(qe,`You gained this insight after ${p??""}.`),M.disabled=e(B)||e(k)},[()=>new Date(e(v).timestamp).toLocaleString(),()=>e(v).mood.join(", "),()=>ne(e(R))],Ie),te(U,()=>e(E),a=>r(E,a)),te(V,()=>e(I),a=>r(I,a)),Z("click",M,ve),f(S,T)};g(b,S=>{e(v)&&S(j)},y)}};g(t,b=>{e(q)?b(m):b(ue,!1)},n)}};g(ce,t=>{e(D)?t(fe):t(de,!1)})}s(L),f(se,L),De(),oe()}export{at as component};
