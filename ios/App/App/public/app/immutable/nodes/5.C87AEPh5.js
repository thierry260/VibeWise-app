import{t as c,a as v}from"../chunks/DwZKRegf.js";import"../chunks/B4OBRiys.js";import{p as Ut,m as A,t as k,a as qt,c as r,b as n,r as s,g as t,s as j,y as gt,av as Ht,f as Vt,n as At}from"../chunks/BfLd7xIT.js";import{e as p,s as b}from"../chunks/D2q-kWfj.js";import{i as h}from"../chunks/CNGqELc8.js";import{e as Dt,i as Mt}from"../chunks/D2bNO8Ei.js";import{r as Gt,s as Ot}from"../chunks/Dh16Ucvd.js";import{s as Ct}from"../chunks/Bfc47y5P.js";import{i as Yt}from"../chunks/DsaIGbBj.js";import{s as zt,a as Jt}from"../chunks/Dfb5LgfT.js";import{c as Kt,o as Qt}from"../chunks/BtKD0jUe.js";import{g as $t}from"../chunks/CRbbwQ-c.js";import{a as Wt}from"../chunks/DuaF19nW.js";import{i as Xt,j as Zt,a as te}from"../chunks/CESdso1d.js";import{s as q}from"../chunks/CGJ70UkG.js";import{b as ee}from"../chunks/ruYCseK5.js";import{p as Nt}from"../chunks/VC9gmQBp.js";var ae=c('<span class="filter-badge svelte-1h80j2t"> </span>'),se=c('<span class="filter-badge svelte-1h80j2t"> </span>'),re=c('<span class="filter-badge svelte-1h80j2t"> </span>'),ie=c('<span class="filter-badge svelte-1h80j2t"> </span>'),ne=c('<span class="filter-badge svelte-1h80j2t"> </span>'),le=c('<button class="reset-button svelte-1h80j2t">Reset</button>'),oe=c("<button> </button>"),ve=c('<button class="filter-chip clear svelte-1h80j2t">Clear</button>'),ce=c('<button class="filter-chip clear svelte-1h80j2t">Clear</button>'),de=c("<button> </button>"),ue=c('<button class="filter-chip clear svelte-1h80j2t">Clear All</button>'),fe=c('<div class="filter-section svelte-1h80j2t"><h3 class="svelte-1h80j2t">Tags</h3> <div class="filter-chips svelte-1h80j2t"><!> <!></div></div>'),pe=c('<div class="filters-panel svelte-1h80j2t"><div class="filter-section svelte-1h80j2t"><h3 class="svelte-1h80j2t">Session Type</h3> <div class="filter-chips svelte-1h80j2t"><button>üñäÔ∏è Reflections</button> <button>üìà HRV Sessions</button> <button>üß† Balcony Insights</button></div></div> <div class="filter-section svelte-1h80j2t"><h3 class="svelte-1h80j2t">Spiral Phase</h3> <div class="filter-chips svelte-1h80j2t"><!> <!></div></div> <div class="filter-section svelte-1h80j2t"><h3 class="svelte-1h80j2t">Mood Level</h3> <div class="filter-chips svelte-1h80j2t"><button>üòä High</button> <button>üòê Neutral</button> <button>üòî Low</button> <!></div></div> <!> <div class="filter-section svelte-1h80j2t"><h3 class="svelte-1h80j2t">Search</h3> <div class="search-input svelte-1h80j2t"><input type="text" placeholder="Search in reflections and insights..." class="svelte-1h80j2t"> <button class="search-button svelte-1h80j2t">Search</button></div></div></div>'),he=c('<div class="filters-container svelte-1h80j2t"><div class="filters-header svelte-1h80j2t"><button class="filter-toggle svelte-1h80j2t"> <span class="filter-icon svelte-1h80j2t"> </span></button> <div class="active-filters-summary svelte-1h80j2t"><!> <!> <!> <!> <!> <!></div></div> <!></div>');function _e(Tt,it){Ut(it,!1);let yt=Nt(it,"availableTags",24,()=>[]),e=Nt(it,"activeFilters",28,()=>({types:["reflection","hrv_session","balcony"],tags:[]})),S=A(!1),$=A(e().searchText||"");const tt=["Beige","Purple","Red","Blue","Orange","Green","Yellow","Turquoise"],Y=Kt();function B(a){e().types.includes(a)?e(e().types=e().types.filter(l=>l!==a),!0):e(e().types=[...e().types,a],!0),M()}function nt(a){e(e().spiralPhase=e().spiralPhase===a?void 0:a,!0),M()}function C(a){e(e().moodLevel=e().moodLevel===a?void 0:a,!0),M()}function lt(a){e().tags.includes(a)?e(e().tags=e().tags.filter(l=>l!==a),!0):e(e().tags=[...e().tags,a],!0),M()}function L(){e(e().searchText=t($).trim()||void 0,!0),M()}function G(){e({types:["reflection","hrv_session","balcony"],tags:[]}),j($,""),M()}function M(){Y("filter",{filters:e()})}function wt(){j(S,!t(S))}Yt();var ot=he(),vt=r(ot),O=r(vt),ct=r(O),mt=n(ct),Lt=r(mt,!0);s(mt),s(O);var xt=n(O,2),dt=r(xt);{var ut=a=>{var l=ae(),g=r(l);s(l),k(()=>b(g,`Types: ${e().types.length??""}`)),v(a,l)};h(dt,a=>{e().types.length<3&&a(ut)})}var ft=n(dt,2);{var Pt=a=>{var l=se(),g=r(l);s(l),k(()=>b(g,`Phase: ${e().spiralPhase??""}`)),v(a,l)};h(ft,a=>{e().spiralPhase&&a(Pt)})}var jt=n(ft,2);{var Ft=a=>{var l=re(),g=r(l);s(l),k(()=>b(g,`Mood: ${e().moodLevel??""}`)),v(a,l)};h(jt,a=>{e().moodLevel&&a(Ft)})}var i=n(jt,2);{var u=a=>{var l=ie(),g=r(l);s(l),k(()=>b(g,`Tags: ${e().tags.length??""}`)),v(a,l)};h(i,a=>{e().tags.length>0&&a(u)})}var N=n(i,2);{var It=a=>{var l=ne(),g=r(l);s(l),k(()=>b(g,`Search: "${e().searchText??""}"`)),v(a,l)};h(N,a=>{e().searchText&&a(It)})}var U=n(N,2);{var z=a=>{var l=le();p("click",l,G),v(a,l)};h(U,a=>{(e().types.length<3||e().spiralPhase||e().moodLevel||e().tags.length>0||e().searchText)&&a(z)})}s(xt),s(vt);var J=n(vt,2);{var pt=a=>{var l=pe(),g=r(l),et=n(r(g),2),K=r(et),P=n(K,2),x=n(P,2);s(et),s(g);var o=n(g,2),T=n(r(o),2),R=r(T);Dt(R,1,()=>tt,Mt,(f,d)=>{var y=oe(),I=r(y,!0);s(y),k(()=>{q(y,1,`filter-chip ${e().spiralPhase===t(d)?"active":""}`,"svelte-1h80j2t"),b(I,t(d))}),p("click",y,()=>nt(t(d))),v(f,y)});var Q=n(R,2);{var at=f=>{var d=ve();p("click",d,()=>nt(void 0)),v(f,d)};h(Q,f=>{e().spiralPhase&&f(at)})}s(T),s(o);var W=n(o,2),st=n(r(W),2),ht=r(st),rt=n(ht,2),_t=n(rt,2),bt=n(_t,2);{var Et=f=>{var d=ce();p("click",d,()=>C(void 0)),v(f,d)};h(bt,f=>{e().moodLevel&&f(Et)})}s(st),s(W);var kt=n(W,2);{var Bt=f=>{var d=fe(),y=n(r(d),2),I=r(y);Dt(I,1,yt,Mt,(_,m)=>{var D=de(),X=r(D);s(D),k(Z=>{q(D,1,`filter-chip ${Z??""}`,"svelte-1h80j2t"),b(X,`#${t(m)??""}`)},[()=>e().tags.includes(t(m))?"active":""],gt),p("click",D,()=>lt(t(m))),v(_,D)});var E=n(I,2);{var V=_=>{var m=ue();p("click",m,()=>{e(e().tags=[],!0),M()}),v(_,m)};h(E,_=>{e().tags.length>0&&_(V)})}s(y),s(d),v(f,d)};h(kt,f=>{yt().length>0&&f(Bt)})}var St=n(kt,2),w=n(r(St),2),F=r(w);Gt(F);var H=n(F,2);s(w),s(St),s(l),k((f,d,y)=>{q(K,1,`filter-chip ${f??""}`,"svelte-1h80j2t"),q(P,1,`filter-chip ${d??""}`,"svelte-1h80j2t"),q(x,1,`filter-chip ${y??""}`,"svelte-1h80j2t"),q(ht,1,`filter-chip ${e().moodLevel==="high"?"active":""}`,"svelte-1h80j2t"),q(rt,1,`filter-chip ${e().moodLevel==="neutral"?"active":""}`,"svelte-1h80j2t"),q(_t,1,`filter-chip ${e().moodLevel==="low"?"active":""}`,"svelte-1h80j2t")},[()=>e().types.includes("reflection")?"active":"",()=>e().types.includes("hrv_session")?"active":"",()=>e().types.includes("balcony")?"active":""],gt),p("click",K,()=>B("reflection")),p("click",P,()=>B("hrv_session")),p("click",x,()=>B("balcony")),p("click",ht,()=>C("high")),p("click",rt,()=>C("neutral")),p("click",_t,()=>C("low")),ee(F,()=>t($),f=>j($,f)),p("keydown",F,f=>f.key==="Enter"&&L()),p("click",H,L),v(a,l)};h(J,a=>{t(S)&&a(pt)})}s(ot),k(()=>{b(ct,`${t(S)?"Hide Filters":"Show Filters"} `),b(Lt,t(S)?"‚ñ≤":"‚ñº")}),p("click",O,wt),v(Tt,ot),qt()}var be=c('<div class="loading svelte-9netxt"><div class="loading-spinner svelte-9netxt"></div> <p>Loading your sessions...</p></div>'),ge=c('<div class="error-message svelte-9netxt"><p> </p> <button class="retry-button svelte-9netxt">Try Again</button></div>'),ye=c('<p>No sessions match your current filters.</p> <p>Try adjusting your filters or <button class="text-button svelte-9netxt">reset them</button>.</p>',1),me=c("<p>You haven't created any sessions yet.</p> <p>Start by creating a reflection or HRV session!</p>",1),xe=c('<div class="empty-state svelte-9netxt"><!></div>'),je=c('<button class="add-balcony-button svelte-9netxt">Add Balcony Insight</button>'),ke=c('<div class="has-balcony svelte-9netxt"><span class="balcony-badge svelte-9netxt">Has Balcony Insight</span> <button class="view-balcony-button svelte-9netxt">View/Edit</button></div>'),Se=c('<div class="session-content svelte-9netxt"><p class="mood svelte-9netxt"> </p> <p class="text-preview svelte-9netxt"> </p> <!></div>'),$e=c('<div class="session-content svelte-9netxt"><p class="hrv-stats svelte-9netxt"><span> </span> <span> </span></p></div>'),Te=c('<div class="session-content svelte-9netxt"><p class="balcony-pattern svelte-9netxt"> </p> <p class="balcony-truth svelte-9netxt"> </p></div>'),we=c('<div class="session-card svelte-9netxt" tabindex="0" role="button"><div class="session-icon svelte-9netxt"> </div> <div class="session-details svelte-9netxt"><div class="session-header svelte-9netxt"><span class="session-type svelte-9netxt"> </span> <span class="session-time svelte-9netxt"> </span></div> <div class="session-date svelte-9netxt"> </div> <!></div></div>'),Le=c('<div class="loading-more svelte-9netxt"><div class="loading-spinner svelte-9netxt"></div> <p>Loading more sessions...</p></div>'),Pe=c('<div class="load-more-container svelte-9netxt"><button class="load-more-button svelte-9netxt">Load More</button></div>'),Fe=c('<div class="sessions-list svelte-9netxt"></div> <!>',1),Ie=c('<div class="history-container svelte-9netxt"><!> <!></div>');function Ke(Tt,it){Ut(it,!1);const[yt,e]=zt(),S=()=>Jt(Wt,"$authStore",yt);let $=A([]),tt=A(!0),Y=A(null),B=A({}),nt=A([]),C=A(!1),lt,L=A({types:["reflection","hrv_session","balcony"],tags:[],spiralPhase:void 0,moodLevel:void 0,searchText:void 0});async function G(i=!0){if(S().user)try{j(tt,!0),j(Y,null),i&&(lt=void 0,j($,[]));const u=await Zt(S().user,t(L),10,lt);u.success&&u.sessions?(j($,i?u.sessions:[...t($),...u.sessions]),lt=u.lastDoc,j(C,u.hasMore||!1),await vt()):j(Y,"Failed to load sessions.")}catch(u){console.error("Error loading sessions:",u),j(Y,"An unexpected error occurred while loading sessions.")}finally{j(tt,!1)}}async function M(){t(C)&&await G(!1)}async function wt(){if(S().user)try{const i=await Xt(S().user);i.success&&i.tags&&j(nt,i.tags)}catch(i){console.error("Error loading tags:",i)}}function ot(i){j(L,i.detail.filters),G()}Qt(async()=>{S().user&&(await wt(),await G())});async function vt(){if(!S().user)return;const i=t($).filter(u=>u.type==="reflection").map(u=>u.id);for(const u of i)try{const N=await te(S().user,u);Ht(B,t(B)[u]=N.success)}catch(N){console.error(`Error checking balcony for reflection ${u}:`,N),Ht(B,t(B)[u]=!1)}}function O(i){i.type==="reflection"?$t(`/reflection/${i.id}`):i.type==="hrv_session"?$t(`/hrv-detail?id=${i.id}`):i.type==="balcony"&&$t(`/balcony?reflectionId=${i.parent_reflection_id}`)}function ct(i){$t(`/balcony?reflectionId=${i}`)}function mt(i){return new Date(i).toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric",year:"numeric"})}function Lt(i){return new Date(i).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}function xt(i){switch(i){case"reflection":return"üñäÔ∏è";case"hrv_session":return"üìà";case"balcony":return"üß†";default:return"üìù"}}function dt(i){switch(i){case"reflection":return"Reflection";case"hrv_session":return"HRV Session";case"balcony":return"Balcony Experiment";default:return"Session"}}Yt();var ut=Ie(),ft=r(ut);_e(ft,{get availableTags(){return t(nt)},get activeFilters(){return t(L)},$$events:{filter:ot}});var Pt=n(ft,2);{var jt=i=>{var u=be();v(i,u)},Ft=(i,u)=>{{var N=U=>{var z=ge(),J=r(z),pt=r(J,!0);s(J);var a=n(J,2);s(z),k(()=>b(pt,t(Y))),p("click",a,()=>G()),v(U,z)},It=(U,z)=>{{var J=a=>{var l=xe(),g=r(l);{var et=P=>{var x=ye(),o=n(Vt(x),2),T=n(r(o));At(),s(o),p("click",T,()=>{j(L,{types:["reflection","hrv_session","balcony"],tags:[],spiralPhase:void 0,moodLevel:void 0,searchText:void 0}),G()}),v(P,x)},K=P=>{var x=me();At(2),v(P,x)};h(g,P=>{t(L).types.length<3||t(L).spiralPhase||t(L).moodLevel||t(L).tags.length>0||t(L).searchText?P(et):P(K,!1)})}s(l),v(a,l)},pt=a=>{var l=Fe(),g=Vt(l);Dt(g,5,()=>t($),Mt,(x,o)=>{var T=we(),R=r(T),Q=r(R,!0);s(R);var at=n(R,2),W=r(at),st=r(W),ht=r(st,!0);s(st);var rt=n(st,2),_t=r(rt,!0);s(rt),s(W);var bt=n(W,2),Et=r(bt,!0);s(bt);var kt=n(bt,2);{var Bt=w=>{var F=Se(),H=r(F),f=r(H,!0);s(H);var d=n(H,2),y=r(d);s(d);var I=n(d,2);{var E=_=>{var m=je();p("click",m,Ct(()=>ct(t(o).id))),v(_,m)},V=(_,m)=>{{var D=X=>{var Z=ke(),Rt=n(r(Z),2);s(Z),p("click",Rt,Ct(()=>ct(t(o).id))),v(X,Z)};h(_,X=>{t(B)[t(o).id]===!0&&X(D)},m)}};h(I,_=>{t(B)[t(o).id]===!1?_(E):_(V,!1)})}s(F),k((_,m)=>{b(f,_),b(y,`${m??""}${t(o).text.length>100?"...":""}`)},[()=>t(o).mood.join(", "),()=>t(o).text.substring(0,100)],gt),v(w,F)},St=(w,F)=>{{var H=d=>{var y=$e(),I=r(y),E=r(I),V=r(E);s(E);var _=n(E,2),m=r(_);s(_),s(I),s(y),k(()=>{b(V,`Avg HR: ${t(o).avg_hr??""} bpm`),b(m,`Vibe Score: ${t(o).vibe_score??""}`)}),v(d,y)},f=(d,y)=>{{var I=E=>{var V=Te(),_=r(V),m=r(_);s(_);var D=n(_,2),X=r(D);s(D),s(V),k((Z,Rt)=>{b(m,`Pattern: ${Z??""}${t(o).pattern.length>100?"...":""}`),b(X,`Truth: ${Rt??""}${t(o).truth.length>100?"...":""}`)},[()=>t(o).pattern.substring(0,100),()=>t(o).truth.substring(0,100)],gt),v(E,V)};h(d,E=>{t(o).type==="balcony"&&E(I)},y)}};h(w,d=>{t(o).type==="hrv_session"?d(H):d(f,!1)},F)}};h(kt,w=>{t(o).type==="reflection"?w(Bt):w(St,!1)})}s(at),s(T),k((w,F,H,f,d)=>{Ot(T,"aria-label",w),b(Q,F),b(ht,H),b(_t,f),b(Et,d)},[()=>`View ${dt(t(o).type)} details`,()=>xt(t(o).type),()=>dt(t(o).type),()=>Lt(t(o).timestamp),()=>mt(t(o).timestamp)],gt),p("click",T,()=>O(t(o))),p("keydown",T,w=>w.key==="Enter"&&O(t(o))),v(x,T)}),s(g);var et=n(g,2);{var K=x=>{var o=Le();v(x,o)},P=(x,o)=>{{var T=R=>{var Q=Pe(),at=r(Q);s(Q),p("click",at,M),v(R,Q)};h(x,R=>{t(C)&&R(T)},o)}};h(et,x=>{t(tt)&&t($).length>0?x(K):x(P,!1)})}v(a,l)};h(U,a=>{t($).length===0?a(J):a(pt,!1)},z)}};h(i,U=>{t(Y)?U(N):U(It,!1)},u)}};h(Pt,i=>{t(tt)&&t($).length===0?i(jt):i(Ft,!1)})}s(ut),v(Tt,ut),qt(),e()}export{Ke as component};
