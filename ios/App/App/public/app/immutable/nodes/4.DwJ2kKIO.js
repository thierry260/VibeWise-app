import{t as y,a as f,b as J}from"../chunks/DCf4MLEm.js";import"../chunks/Br8XnZlm.js";import{p as Be,b as Ee,s as a,m as d,g as e,e as n,c as o,r as s,t as _,ac as $e,d as De}from"../chunks/BtKWLSPg.js";import{s as u,e as ae,r as re}from"../chunks/BG1n1Yyg.js";import{i as q}from"../chunks/grgeRSmy.js";import{e as Ie,i as Re}from"../chunks/DjnkB4tD.js";import{b as se}from"../chunks/CBpoeqWO.js";import{i as Me}from"../chunks/BYQBo7FT.js";import{s as Te,a as ie}from"../chunks/D4asRrhy.js";import{o as Pe}from"../chunks/RUtFCPZu.js";import{p as ke}from"../chunks/BTHMLjqK.js";import{g as oe}from"../chunks/U7y0OYIa.js";import{a as Le}from"../chunks/Cb8aidWk.js";import{g as Fe,a as Ue,u as Ae,c as Oe}from"../chunks/BTsfAa0b.js";var We=y('<div class="loading svelte-q3fqj7">Loading reflection data...</div>'),Ye=y('<div class="error-card svelte-q3fqj7"><h2 class="svelte-q3fqj7">Error</h2> <p> </p> <button class="svelte-q3fqj7">Return Home</button></div>'),ze=y('<span class="tag svelte-q3fqj7"> </span>'),He=y('<div class="tags svelte-q3fqj7"></div>'),Ne=y('<div class="error-message svelte-q3fqj7"> </div>'),Ce=y('<div class="original-reflection svelte-q3fqj7"><h2 class="svelte-q3fqj7">Original Reflection</h2> <div class="reflection-card svelte-q3fqj7"><div class="reflection-header svelte-q3fqj7"><span class="timestamp svelte-q3fqj7"> </span> <span class="mood-tag svelte-q3fqj7"> </span></div> <p class="reflection-text svelte-q3fqj7"> </p> <!></div> <div class="time-difference svelte-q3fqj7"><span> </span></div></div> <div class="form-section svelte-q3fqj7"><h2 class="svelte-q3fqj7">What pattern or limiting belief did you notice?</h2> <textarea placeholder="Describe the pattern or limiting belief you observed in yourself..." rows="3" class="svelte-q3fqj7"></textarea></div> <div class="form-section svelte-q3fqj7"><h2 class="svelte-q3fqj7">What insight or truth did you discover when you zoomed out?</h2> <textarea placeholder="Share the honest truth or insight you gained with perspective..." rows="3" class="svelte-q3fqj7"></textarea></div> <!> <button class="submit-button svelte-q3fqj7"><!></button>',1),Ge=y('<div class="balcony-container svelte-q3fqj7"><h1 class="svelte-q3fqj7">Balcony Experiment</h1> <!></div>');function nt(le,ne){Be(ne,!1);const[K,ce]=Te(),ve=()=>ie(ke,"$page",K),b=()=>ie(Le,"$authStore",K);let c=d(null),x=null,j=d(null),T=d(!0),w=null,S=d(!1),B=d(""),E=d(""),D=d(0),P=d(!1),F=d(!1),m=d(null);Pe(async()=>{if(x=ve().url.searchParams.get("reflectionId"),!x){a(j,"No reflection ID provided. Balcony experiments must be linked to a reflection."),a(T,!1);return}if(!b().user){a(j,"You must be logged in to create a balcony experiment."),a(T,!1);return}try{const t=await Fe(b().user,x);if(t.success&&t.reflection){a(c,t.reflection);const i=await Ue(b().user,x);if(i.success&&i.balcony)w=i.balcony,a(S,!0),a(B,w.pattern),a(E,w.truth),a(D,w.delay_minutes);else{const p=new Date(e(c).timestamp).getTime(),A=new Date().getTime();a(D,Math.floor((A-p)/(1e3*60)))}}else a(j,"Failed to load reflection. It may have been deleted.")}catch(t){console.error("Error loading reflection:",t),a(j,"An error occurred while loading the reflection.")}finally{a(T,!1)}});function fe(t){if(t<60)return`${t} minute${t!==1?"s":""}`;const i=Math.floor(t/60),p=t%60;return p===0?`${i} hour${i!==1?"s":""}`:`${i} hour${i!==1?"s":""} and ${p} minute${p!==1?"s":""}`}async function de(){if(!(!b().user||!x||!e(c))){if(!e(B).trim()){a(m,"Please enter a limiting belief or pattern");return}if(!e(E).trim()){a(m,"Please enter your honest truth or insight");return}a(P,!0),a(m,null);try{let t;if(e(S)&&w){const i={pattern:e(B).trim(),truth:e(E).trim(),delay_minutes:e(D)};t=await Ae(b().user,w.id,i)}else{const i={timestamp:new Date().toISOString(),parent_reflection_id:x,pattern:e(B).trim(),truth:e(E).trim(),delay_minutes:e(D)};t=await Oe(b().user,i)}t.success?(a(F,!0),setTimeout(()=>{oe("/history")},2e3)):a(m,`Failed to ${e(S)?"update":"save"} balcony experiment. Please try again.`)}catch(t){console.error("Error submitting balcony experiment:",t),a(m,"An unexpected error occurred. Please try again.")}finally{a(P,!1)}}}Me();var U=Ge(),ue=n(o(U),2);{var me=t=>{var i=We();f(t,i)},pe=(t,i)=>{{var p=$=>{var I=Ye(),R=n(o(I),2),M=o(R,!0);s(R);var k=n(R,2);s(I),_(()=>u(M,e(j))),ae("click",k,()=>oe("/home")),f($,I)},A=($,I)=>{{var R=M=>{var k=Ce(),O=$e(k),W=n(o(O),2),Y=o(W),z=o(Y),he=o(z,!0);s(z);var Q=n(z,2),ge=o(Q,!0);s(Q),s(Y);var H=n(Y,2),_e=o(H,!0);s(H);var qe=n(H,2);{var ye=r=>{var l=He();Ie(l,5,()=>e(c).tags,Re,(h,G)=>{var v=ze(),g=o(v,!0);s(v),_(()=>u(g,e(G))),f(h,v)}),s(l),f(r,l)};q(qe,r=>{e(c).tags&&e(c).tags.length>0&&r(ye)})}s(W);var V=n(W,2),X=o(V),be=o(X);s(X),s(V),s(O);var N=n(O,2),Z=n(o(N),2);re(Z),s(N);var C=n(N,2),ee=n(o(C),2);re(ee),s(C);var te=n(C,2);{var xe=r=>{var l=Ne(),h=o(l,!0);s(l),_(()=>u(h,e(m))),f(r,l)};q(te,r=>{e(m)&&r(xe)})}var L=n(te,2),je=o(L);{var we=r=>{var l=J();_(()=>u(l,e(S)?"Updating...":"Saving...")),f(r,l)},Se=(r,l)=>{{var h=v=>{var g=J();_(()=>u(g,e(S)?"Updated!":"Saved!")),f(v,g)},G=v=>{var g=J();_(()=>u(g,e(S)?"Update Balcony Insight":"Save Balcony Insight")),f(v,g)};q(r,v=>{e(F)?v(h):v(G,!1)},l)}};q(je,r=>{e(P)?r(we):r(Se,!1)})}s(L),_((r,l,h)=>{u(he,r),u(ge,l),u(_e,e(c).text),u(be,`You gained this insight after ${h??""}.`),L.disabled=e(P)||e(F)},[()=>new Date(e(c).timestamp).toLocaleString(),()=>e(c).mood.join(", "),()=>fe(e(D))],De),se(Z,()=>e(B),r=>a(B,r)),se(ee,()=>e(E),r=>a(E,r)),ae("click",L,de),f(M,k)};q($,M=>{e(c)&&M(R)},I)}};q(t,$=>{e(j)?$(p):$(A,!1)},i)}};q(ue,t=>{e(T)?t(me):t(pe,!1)})}s(U),f(le,U),Ee(),ce()}export{nt as component};
