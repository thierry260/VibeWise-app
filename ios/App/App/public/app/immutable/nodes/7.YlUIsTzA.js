import{t as m,a as g}from"../chunks/CN_4Jffs.js";import"../chunks/C_EceCEL.js";import{p as $e,b as je,c as a,s as c,m as k,g as e,n as E,r as i,e as o,t as J,d as w,ac as ze}from"../chunks/C32UjKbq.js";import{e as V,s as b}from"../chunks/HXctbdJI.js";import{i as F}from"../chunks/CdUhBWiK.js";import{b as Ae}from"../chunks/WEtHXLpi.js";import{i as Ge}from"../chunks/BT-A8O5u.js";import{s as Pe,a as te}from"../chunks/D2OzG1jj.js";import{o as Ye}from"../chunks/D1wvVs1Z.js";import{p as Ne}from"../chunks/DQYYXLft.js";import{g as se}from"../chunks/C028ppxN.js";import{a as Oe}from"../chunks/DxcAzl92.js";import{d as Ue}from"../chunks/L29Sq4FH.js";import{u as qe,M as L,g as We}from"../chunks/DimFh-gf.js";var Je=m('<div class="loading svelte-vfdbly">Loading session details...</div>'),Ke=m('<div class="error-message svelte-vfdbly"> </div>'),Qe=m('<div class="interpretation-text svelte-vfdbly">No score available</div>'),Xe=m('<div class="interpretation-emoji svelte-vfdbly"> </div> <div class="interpretation-text svelte-vfdbly"> </div>',1),Ze=m('<div class="session-info svelte-vfdbly"><div class="session-header svelte-vfdbly"><div class="session-date svelte-vfdbly"> </div> <div class="session-time svelte-vfdbly"> </div></div> <div class="metrics-grid svelte-vfdbly"><button class="metric-tile svelte-vfdbly" aria-label="Heart Rate Information"><h3 class="svelte-vfdbly">Heart Rate</h3> <p class="value svelte-vfdbly"> <span class="unit svelte-vfdbly">BPM</span></p> <!></button> <button class="metric-tile svelte-vfdbly" aria-label="Balance Information"><h3 class="svelte-vfdbly">Balance</h3> <p class="value svelte-vfdbly"> <span class="unit svelte-vfdbly">ms</span></p> <!></button> <button class="metric-tile svelte-vfdbly" aria-label="Session Time Information"><h3 class="svelte-vfdbly">Duration</h3> <p class="value svelte-vfdbly"> </p> <!></button> <button class="metric-tile vibe-tile svelte-vfdbly" aria-label="Vibe Score Information"><h3 class="svelte-vfdbly">Vibe Score</h3> <p class="value svelte-vfdbly"> </p> <div class="vibe-interpretation svelte-vfdbly"><!></div> <!></button></div> <div class="chart-section svelte-vfdbly"><h2 class="svelte-vfdbly">Session Data</h2> <div class="chart-container svelte-vfdbly"></div> <div class="unified-legend svelte-vfdbly"><div class="legend-item svelte-vfdbly"><div class="legend-dot hr-dot svelte-vfdbly"></div> <span class="legend-label svelte-vfdbly">Heart Rate</span></div> <div class="legend-item svelte-vfdbly"><div class="legend-dot rmssd-dot svelte-vfdbly"></div> <span class="legend-label svelte-vfdbly">Balance</span></div> <div class="legend-item svelte-vfdbly"><div class="legend-dot vibe-dot svelte-vfdbly"></div> <span class="legend-label svelte-vfdbly">Vibe Score</span></div></div></div></div>'),et=m('<div class="error-message svelte-vfdbly">Session not found</div>'),tt=m('<div class="hrv-detail-container svelte-vfdbly"><div class="header svelte-vfdbly"><button class="back-button svelte-vfdbly"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-vfdbly"><path d="M19 12H5M12 19l-7-7 7-7"></path></svg> Back</button> <h1 class="svelte-vfdbly">HRV Session Details</h1></div> <!></div>');function gt(ae,ie){$e(ie,!1);const[K,re]=Pe(),Q=()=>te(Oe,"$authStore",K),oe=()=>te(Ne,"$page",K);let v=k(null),$=k(!0),S=k(null),h=k(),f=null,d=k(null);const s={heartRate:{title:"Heart Rate",explanation:"Your heart rate is the number of times your heart beats per minute.",hint:"A lower resting heart rate often indicates better cardiovascular fitness.",stateDescription:"Your heart rate changes throughout the day based on activity, emotions, and rest.",suggestion:"Deep, slow breathing can help lower your heart rate when it is elevated."},balance:{title:"Balance (RMSSD)",explanation:"Balance measures the variation between heartbeats, indicating how your nervous system is responding.",hint:"Higher values typically suggest better recovery and resilience.",stateDescription:"This metric reflects the balance between your sympathetic (action) and parasympathetic (rest) systems.",suggestion:"Regular relaxation practices can help improve your balance over time."},vibeScore:{title:"Vibe Score",explanation:"Your Vibe Score combines multiple HRV metrics into one easy-to-understand number.",hint:"Higher scores indicate a more balanced physiological state.",stateDescription:"This score reflects your overall physiological balance at the time of measurement.",suggestion:"Regular sessions can help you understand what activities improve your score."},time:{title:"Session Duration",explanation:"The total time you spent in this HRV measurement session.",hint:"Even short sessions can provide valuable insights.",stateDescription:"Longer sessions may reveal patterns in how your body responds over time.",suggestion:"Aim for at least 5 minutes for the most reliable readings."}};function H(t){e(d)===t?c(d,null):c(d,t)}Ye(async()=>{if(!Q().user){se("/login");return}const t=oe().url.searchParams.get("id");if(!t){c(S,"No session ID provided."),c($,!1);return}try{const n=await Ue(Q().user,t);n.success&&n.session&&n.session.type==="hrv_session"?(c(v,n.session),setTimeout(()=>{e(h)&&e(v)&&ne()},100)):c(S,"Failed to load HRV session or session not found.")}catch(n){console.error("Error loading HRV session:",n),c(S,"An unexpected error occurred while loading the session.")}finally{c($,!1)}});function ne(){if(!e(h)||!e(v)){console.error("Chart element or session data not found");return}const t=[],n=[],y=[],B=[];e(v).chart_data.forEach(r=>{const l=new Date(r.timestamp).getTime()/1e3;t.push(l),n.push(r.hr),y.push(r.rmssd),B.push(r.vibe)});const p={width:e(h).clientWidth,height:300,padding:[20,0,0,0],cursor:{show:!0,points:{show:!1},drag:{setScale:!1},focus:{prox:30}},legend:{show:!1},series:[{},{scale:"hr",label:"Heart Rate",value:(r,l)=>l==null?"-":l.toFixed(0)+" bpm",stroke:"rgba(229, 57, 53, 0.8)",width:2,points:{show:!1},spanGaps:!0},{scale:"rmssd",label:"Balance",value:(r,l)=>l==null?"-":l.toFixed(1)+" ms",stroke:"rgba(77, 68, 179, 0.8)",width:2,points:{show:!1},spanGaps:!0},{scale:"vibe",label:"Vibe Score",value:(r,l)=>l==null?"-":l.toFixed(0),stroke:"rgba(191, 70, 154, 0.8)",width:2,points:{show:!1},spanGaps:!0}],scales:{x:{time:!0},hr:{auto:!0,range:[40,180]},rmssd:{auto:!0,range:[0,100]},vibe:{auto:!0,range:[0,100]}},axes:[{},{}]};try{f=new qe(p,[t,n,y,B],e(h));const r=new ResizeObserver(l=>{f&&l[0]&&f.setSize({width:l[0].contentRect.width,height:300})});return r.observe(e(h)),()=>{f&&(f.destroy(),f=null),r.disconnect()}}catch(r){console.error("Error creating chart:",r)}}function le(t){return new Date(t).toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric",year:"numeric"})}function ve(t){return new Date(t).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}function ce(t){const n=Math.floor(t/60),y=t%60;return`${n}:${y.toString().padStart(2,"0")}`}function de(){se("/history")}Ge();var j=tt(),z=a(j),ue=a(z);E(2),i(z);var be=o(z,2);{var pe=t=>{var n=Je();g(t,n)},he=(t,n)=>{{var y=p=>{var r=Ke(),l=a(r,!0);i(r),J(()=>b(l,e(S))),g(p,r)},B=(p,r)=>{{var l=_=>{var D=Ze(),A=a(D),G=a(A),me=a(G,!0);i(G);var X=o(G,2),fe=a(X,!0);i(X),i(A);var P=o(A,2),T=a(P),Y=o(a(T),2),ye=a(Y);E(),i(Y);var _e=o(Y,2);const xe=w(()=>e(d)==="heartRate");L(_e,{get isVisible(){return e(xe)},onClose:()=>c(d,null),get title(){return s.heartRate.title},get explanation(){return s.heartRate.explanation},get hint(){return s.heartRate.hint},get stateDescription(){return s.heartRate.stateDescription},get suggestion(){return s.heartRate.suggestion}}),i(T);var C=o(T,2),N=o(a(C),2),we=a(N);E(),i(N);var Se=o(N,2);const De=w(()=>e(d)==="balance");L(Se,{get isVisible(){return e(De)},onClose:()=>c(d,null),get title(){return s.balance.title},get explanation(){return s.balance.explanation},get hint(){return s.balance.hint},get stateDescription(){return s.balance.stateDescription},get suggestion(){return s.balance.suggestion}}),i(C);var I=o(C,2),O=o(a(I),2),Re=a(O,!0);i(O);var ke=o(O,2);const Ve=w(()=>e(d)==="time");L(ke,{get isVisible(){return e(Ve)},onClose:()=>c(d,null),get title(){return s.time.title},get explanation(){return s.time.explanation},get hint(){return s.time.hint},get stateDescription(){return s.time.stateDescription},get suggestion(){return s.time.suggestion}}),i(I);var U=o(I,2),q=o(a(U),2),He=a(q,!0);i(q);var W=o(q,2),Be=a(W);{var Te=u=>{var x=Qe();g(u,x)},Ce=u=>{var x=Xe();const M=w(()=>We(e(v).vibe_score));var R=ze(x),Fe=a(R,!0);i(R);var ee=o(R,2),Le=a(ee,!0);i(ee),J(()=>{b(Fe,e(M).emoji),b(Le,e(M).label)}),g(u,x)};F(Be,u=>{e(v).vibe_score?u(Ce,!1):u(Te)})}i(W);var Ie=o(W,2);const Me=w(()=>e(d)==="vibeScore");L(Ie,{get isVisible(){return e(Me)},onClose:()=>c(d,null),get title(){return s.vibeScore.title},get explanation(){return s.vibeScore.explanation},get hint(){return s.vibeScore.hint},get stateDescription(){return s.vibeScore.stateDescription},get suggestion(){return s.vibeScore.suggestion}}),i(U),i(P);var Z=o(P,2),Ee=o(a(Z),2);Ae(Ee,u=>c(h,u),()=>e(h)),E(2),i(Z),i(D),J((u,x,M,R)=>{b(me,u),b(fe,x),b(ye,`${e(v).avg_hr??""} `),b(we,`${M??""} `),b(Re,R),b(He,e(v).vibe_score)},[()=>le(e(v).timestamp),()=>ve(e(v).timestamp),()=>e(v).avg_rmssd.toFixed(1),()=>ce(e(v).duration_seconds)],w),V("click",T,()=>H("heartRate")),V("click",C,()=>H("balance")),V("click",I,()=>H("time")),V("click",U,()=>H("vibeScore")),g(_,D)},ge=_=>{var D=et();g(_,D)};F(p,_=>{e(v)?_(l):_(ge,!1)},r)}};F(t,p=>{e(S)?p(y):p(B,!1)},n)}};F(be,t=>{e($)?t(pe):t(he,!1)})}i(j),V("click",ue,de),g(ae,j),je(),re()}export{gt as component};
