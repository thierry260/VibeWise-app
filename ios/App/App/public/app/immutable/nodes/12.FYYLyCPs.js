import{t as c,a as d,n as ye}from"../chunks/DwZKRegf.js";import"../chunks/B4OBRiys.js";import{p as xe,g as e,m as b,c as r,r as s,a as be,s as v,b as l,t as P,y as ue,av as ge}from"../chunks/BfLd7xIT.js";import{s as L,e as q}from"../chunks/D2q-kWfj.js";import{i as m}from"../chunks/CNGqELc8.js";import{e as pe,i as he}from"../chunks/D2bNO8Ei.js";import{i as je}from"../chunks/DsaIGbBj.js";import{a as _e,s as Ae}from"../chunks/Dfb5LgfT.js";import{o as Le,a as Be}from"../chunks/BtKD0jUe.js";import{p as Me}from"../chunks/DgX6owf5.js";import{g as ke}from"../chunks/CRbbwQ-c.js";import{a as Te}from"../chunks/DuaF19nW.js";import{k as Fe,g as Re}from"../chunks/CESdso1d.js";import{s as ce}from"../chunks/Dh16Ucvd.js";import{s as Pe}from"../chunks/DTh54-LU.js";import{b as Se}from"../chunks/DoWAKkCU.js";import{p as we}from"../chunks/VC9gmQBp.js";const Ce=!1,De=!1;function $e(){return{}}const jt=Object.freeze(Object.defineProperty({__proto__:null,load:$e,prerender:Ce,ssr:De},Symbol.toStringTag,{value:"Module"}));var Ue=c('<div class="loading-container svelte-1krimf1"><div class="loading-ripple svelte-1krimf1"><div class="svelte-1krimf1"></div> <div class="svelte-1krimf1"></div></div> <span class="svelte-1krimf1">Loading your recording...</span></div>'),Ie=c('<div class="error-container svelte-1krimf1"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1krimf1"><circle cx="12" cy="12" r="10" class="svelte-1krimf1"></circle><line x1="12" y1="8" x2="12" y2="12" class="svelte-1krimf1"></line><line x1="12" y1="16" x2="12.01" y2="16" class="svelte-1krimf1"></line></svg> <span class="svelte-1krimf1"> </span></div>'),Ve=ye('<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" stroke="none" class="svelte-1krimf1"><rect x="6" y="4" width="4" height="16" rx="1" class="svelte-1krimf1"></rect><rect x="14" y="4" width="4" height="16" rx="1" class="svelte-1krimf1"></rect></svg>'),Ne=ye('<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" stroke="none" class="svelte-1krimf1"><path d="M6 4l15 8-15 8V4z" class="svelte-1krimf1"></path></svg>'),Oe=c('<div class="zen-wave-visualizer svelte-1krimf1"><div class="zen-wave svelte-1krimf1"></div> <div class="zen-wave svelte-1krimf1"></div> <div class="zen-wave svelte-1krimf1"></div> <div class="zen-wave svelte-1krimf1"></div> <div class="zen-wave svelte-1krimf1"></div></div>'),qe=c('<div class="zen-storage-label svelte-1krimf1"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1krimf1"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" class="svelte-1krimf1"></path><polyline points="7 10 12 15 17 10" class="svelte-1krimf1"></polyline><line x1="12" y1="15" x2="12" y2="3" class="svelte-1krimf1"></line></svg> <span class="svelte-1krimf1">Local</span></div>'),He=c('<div class="zen-player svelte-1krimf1"><div class="zen-player-inner svelte-1krimf1"><button class="zen-play-button svelte-1krimf1"><div class="zen-button-inner svelte-1krimf1"><!></div></button> <div class="zen-controls svelte-1krimf1"><div class="zen-time svelte-1krimf1"> </div> <div class="zen-progress-container svelte-1krimf1" role="slider" aria-label="Audio progress" aria-valuemin="0" aria-valuemax="100" tabindex="0"><div class="zen-progress-track svelte-1krimf1"><div class="zen-progress-fill svelte-1krimf1"></div></div> <!></div> <div class="zen-time svelte-1krimf1"> </div></div> <!></div> <audio preload="auto" class="audio-element svelte-1krimf1"></audio></div>'),We=c('<div class="no-audio-container svelte-1krimf1"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1krimf1"><line x1="1" y1="1" x2="23" y2="23" class="svelte-1krimf1"></line><path d="M9 9v3a3 3 0 0 0 5.12 2.12M15 9.34V4a3 3 0 0 0-5.94-.6" class="svelte-1krimf1"></path><path d="M17 16.95A7 7 0 0 1 5 12v-2m14 0v2a7 7 0 0 1-.11 1.23" class="svelte-1krimf1"></path><line x1="12" y1="19" x2="12" y2="23" class="svelte-1krimf1"></line><line x1="8" y1="23" x2="16" y2="23" class="svelte-1krimf1"></line></svg> <span class="svelte-1krimf1">No audio recording available</span></div>'),Xe=c('<div class="audio-player svelte-1krimf1"><!></div>');function Ge(se,H){xe(H,!1);let D=we(H,"audioPath",8),re=we(H,"showLabel",8,!0),t=b(),$=b(!1),j=b(!1),z=b(""),k=b(null),o=b(0),W=b(0),U=b(0),Q=!1;async function X(){if(D())try{v($,!0),v(k,null),console.log("Loading audio from path:",D());const a=await Fe(D());a.success&&a.url?(console.log("Successfully loaded audio, using blob URL for playback"),v(z,a.url)):(console.error("Failed to load audio:",a.error),v(k,`Failed to load audio: ${a.error||"Unknown error"}`))}catch(a){console.error("Error loading audio:",a),v(k,`Error loading audio: ${a instanceof Error?a.message:String(a)}`)}finally{v($,!1)}}function G(){e(t)&&(e(j)?e(t).pause():e(t).play().catch(a=>{console.error("Error playing audio:",a),v(k,"Error playing audio")}))}function Y(a){if(!isFinite(a)||isNaN(a))return"0:00";const w=Math.floor(a/60),y=Math.floor(a%60);return`${w}:${y<10?"0":""}${y}`}function ie(a){if(!e(t)||!Q||!isFinite(e(o)))return;const y=a.currentTarget.getBoundingClientRect(),J=(a.clientX-y.left)/y.width;ge(t,e(t).currentTime=J*e(t).duration)}function oe(){e(t)&&(e(t).addEventListener("play",()=>{v(j,!0)}),e(t).addEventListener("pause",()=>{v(j,!1)}),e(t).addEventListener("ended",()=>{v(j,!1)}),e(t).addEventListener("loadedmetadata",()=>{console.log("Audio metadata loaded, duration:",e(t).duration),v(o,isFinite(e(t).duration)?e(t).duration:0),Q=!0}),e(t).addEventListener("durationchange",()=>{console.log("Duration changed:",e(t).duration),v(o,isFinite(e(t).duration)?e(t).duration:0)}),e(t).addEventListener("timeupdate",()=>{v(W,e(t).currentTime),isFinite(e(o))&&e(o)>0?v(U,e(W)/e(o)*100):v(U,0)}))}Le(async()=>{await X(),oe()}),Be(()=>{e(z)&&e(z).startsWith("blob:")&&URL.revokeObjectURL(e(z))}),je();var u=Xe(),I=r(u);{var le=a=>{var w=Ue();d(a,w)},ne=(a,w)=>{{var y=g=>{var x=Ie(),M=l(r(x),2),V=r(M,!0);s(M),s(x),P(()=>L(V,e(k))),d(g,x)},J=(g,x)=>{{var M=T=>{var E=He(),N=r(E),S=r(N),Z=r(S),ve=r(Z);{var ee=i=>{var _=Ve();d(i,_)},de=i=>{var _=Ne();d(i,_)};m(ve,i=>{e(j)?i(ee):i(de,!1)})}s(Z),s(S);var O=l(S,2),K=r(O),te=r(K,!0);s(K);var F=l(K,2),n=r(F),f=r(n);s(n);var p=l(n,2);{var A=i=>{var _=Oe();d(i,_)};m(p,i=>{e(j)&&i(A)})}s(F);var R=l(F,2),h=r(R,!0);s(R),s(O);var B=l(O,2);{var ae=i=>{var _=qe();d(i,_)};m(B,i=>{re()&&i(ae)})}s(N);var C=l(N,2);Se(C,i=>v(t,i),()=>e(t)),s(E),P((i,_)=>{ce(S,"aria-label",e(j)?"Pause":"Play"),L(te,i),ce(F,"aria-valuenow",e(U)),Pe(f,`width: ${e(U)??""}%`),L(h,_),ce(C,"src",e(z))},[()=>Y(e(W)),()=>Y(e(o))],ue),q("click",S,G),q("click",F,ie),q("keydown",F,i=>{if(i.key==="Enter"||i.key===" ")i.preventDefault(),G();else if((i.key==="ArrowRight"||i.key==="ArrowLeft")&&(i.preventDefault(),e(t)&&isFinite(e(t).duration))){const _=i.key==="ArrowRight"?Math.min(e(t).duration,e(t).currentTime+e(t).duration*.1):Math.max(0,e(t).currentTime-e(t).duration*.1);ge(t,e(t).currentTime=_)}}),q("error",C,i=>{console.error("Audio element error:",i),v(k,"Unable to play this recording")}),d(T,E)},V=T=>{var E=We();d(T,E)};m(g,T=>{e(z)?T(M):T(V,!1)},x)}};m(a,g=>{e(k)?g(y):g(J,!1)},w)}};m(I,a=>{e($)?a(le):a(ne,!1)})}s(u),d(se,u),be()}var Je=c('<div class="loading svelte-53o5cj">Loading reflection details...</div>'),Ke=c('<div class="error-message svelte-53o5cj"> </div>'),Qe=c('<span class="mood-tag svelte-53o5cj"> </span>'),Ye=c('<div class="mood-section svelte-53o5cj"><h2 class="svelte-53o5cj">Mood</h2> <div class="mood-list svelte-53o5cj"></div></div>'),Ze=c('<span class="tag svelte-53o5cj"> </span>'),et=c('<div class="tags-section svelte-53o5cj"><h2 class="svelte-53o5cj">Tags</h2> <div class="tags-list svelte-53o5cj"></div></div>'),tt=c('<div class="reflection-text svelte-53o5cj"><h2 class="svelte-53o5cj">Reflection</h2> <p class="svelte-53o5cj"> </p></div>'),at=c('<div class="voice-insight svelte-53o5cj"><h3 class="svelte-53o5cj">Voice Analysis</h3> <div class="insight-content svelte-53o5cj"><div class="tone svelte-53o5cj"><span class="label svelte-53o5cj">Detected Tone:</span> <span class="value svelte-53o5cj"> </span></div> <div class="confidence svelte-53o5cj"><span class="label svelte-53o5cj">Confidence:</span> <span class="value svelte-53o5cj"> </span></div></div></div>'),st=c('<div class="audio-section svelte-53o5cj"><h2 class="svelte-53o5cj">Voice Recording</h2> <!> <!></div>'),rt=c('<div class="reflection-card svelte-53o5cj"><div class="reflection-header svelte-53o5cj"><h1 class="svelte-53o5cj">Reflection</h1> <div class="reflection-date svelte-53o5cj"> </div></div> <div class="mood-tags svelte-53o5cj"><!> <!></div> <!> <!> <div class="action-buttons svelte-53o5cj"><button class="balcony-button svelte-53o5cj"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg> Add Balcony Insight</button></div></div>'),it=c('<div class="not-found svelte-53o5cj">Reflection not found.</div>'),ot=c('<div class="reflection-detail-container svelte-53o5cj"><button class="back-button svelte-53o5cj"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg> Back</button> <!></div>');function Lt(se,H){xe(H,!1);const[D,re]=Ae(),t=()=>_e(Me,"$page",D),$=()=>_e(Te,"$authStore",D),j=t().params.id;let z=b(!0),k=b(null),o=b(null);Le(async()=>{if($().user)try{const u=await Re($().user,j);u.success&&u.reflection?v(o,u.reflection):v(k,"Failed to load reflection details.")}catch(u){console.error("Error loading reflection:",u),v(k,"An unexpected error occurred while loading reflection details.")}finally{v(z,!1)}});function W(u){return new Date(u).toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}function U(){ke("/history")}function Q(){ke(`/balcony?reflectionId=${j}`)}je();var X=ot(),G=r(X),Y=l(G,2);{var ie=u=>{var I=Je();d(u,I)},oe=(u,I)=>{{var le=a=>{var w=Ke(),y=r(w,!0);s(w),P(()=>L(y,e(k))),d(a,w)},ne=(a,w)=>{{var y=g=>{var x=rt(),M=r(x),V=l(r(M),2),T=r(V,!0);s(V),s(M);var E=l(M,2),N=r(E);{var S=n=>{var f=Ye(),p=l(r(f),2);pe(p,5,()=>e(o).mood,he,(A,R)=>{var h=Qe(),B=r(h,!0);s(h),P(()=>L(B,e(R))),d(A,h)}),s(p),s(f),d(n,f)};m(N,n=>{e(o).mood&&e(o).mood.length>0&&n(S)})}var Z=l(N,2);{var ve=n=>{var f=et(),p=l(r(f),2);pe(p,5,()=>e(o).tags,he,(A,R)=>{var h=Ze(),B=r(h,!0);s(h),P(()=>L(B,e(R))),d(A,h)}),s(p),s(f),d(n,f)};m(Z,n=>{e(o).tags&&e(o).tags.length>0&&n(ve)})}s(E);var ee=l(E,2);{var de=n=>{var f=tt(),p=l(r(f),2),A=r(p,!0);s(p),s(f),P(()=>L(A,e(o).text)),d(n,f)};m(ee,n=>{e(o).text&&n(de)})}var O=l(ee,2);{var K=n=>{var f=st(),p=l(r(f),2);Ge(p,{get audioPath(){return e(o).audio_url}});var A=l(p,2);{var R=h=>{var B=at(),ae=l(r(B),2),C=r(ae),i=l(r(C),2),_=r(i,!0);s(i),s(C);var fe=l(C,2),me=l(r(fe),2),ze=r(me);s(me),s(fe),s(ae),s(B),P(Ee=>{L(_,e(o).voice_insight.tone),L(ze,`${Ee??""}%`)},[()=>(e(o).voice_insight.confidence*100).toFixed(0)],ue),d(h,B)};m(A,h=>{e(o).voice_insight&&h(R)})}s(f),d(n,f)};m(O,n=>{e(o).audio_url&&n(K)})}var te=l(O,2),F=r(te);s(te),s(x),P(n=>L(T,n),[()=>W(e(o).timestamp)],ue),q("click",F,Q),d(g,x)},J=g=>{var x=it();d(g,x)};m(a,g=>{e(o)?g(y):g(J,!1)},w)}};m(u,a=>{e(k)?a(le):a(ne,!1)},I)}};m(Y,u=>{e(z)?u(ie):u(oe,!1)})}s(X),q("click",G,U),d(se,X),be(),re()}export{Lt as component,jt as universal};
