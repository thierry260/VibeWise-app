import{t as m,a as v,b as pe}from"../chunks/CBOLqkOR.js";import{i as mt}from"../chunks/DYliPJ25.js";import{p as pt,o as _t,t as R,g as e,b as xt,e as r,c as n,d as C,m as c,r as i,n as ze,s,a3 as wt}from"../chunks/Gd2MJtJw.js";import{e as u,r as bt,s as I}from"../chunks/6F2tKI9t.js";import{i as b}from"../chunks/DEjGzwbK.js";import{e as Me,i as Oe}from"../chunks/DyHPtUt5.js";import{a as Ce,r as q,s as gt}from"../chunks/BhW88OIp.js";import{s as F}from"../chunks/C1Vzq84y.js";import{b as _e}from"../chunks/DGJhUISI.js";import{s as kt,a as ht}from"../chunks/7oYGK_Th.js";import{a as yt}from"../chunks/BPWvYGMB.js";import{u as Rt,b as Dt,d as St}from"../chunks/x9z02Rao.js";var Tt=m("<button> </button>"),Et=m("<button> </button>"),Lt=m('<input type="datetime-local" class="svelte-k8wt4x">'),At=m('<button class="record-button svelte-k8wt4x">Start Recording</button>'),It=m('<div class="recording-indicator svelte-k8wt4x"><span class="recording-pulse svelte-k8wt4x"></span> </div> <button class="stop-button svelte-k8wt4x">Stop Recording</button>',1),Pt=m('<button class="analyze-button svelte-k8wt4x">Analyze Voice Tone</button>'),Ut=m('<div class="analyzing svelte-k8wt4x">Analyzing voice tone...</div>'),zt=m('<div class="voice-insight svelte-k8wt4x"><span class="svelte-k8wt4x">Detected tone: <strong class="svelte-k8wt4x"> </strong></span> <span class="svelte-k8wt4x"> </span></div>'),Mt=m('<div class="audio-player svelte-k8wt4x"><audio controls class="svelte-k8wt4x"></audio> <button class="delete-button svelte-k8wt4x">Delete Recording</button> <!></div>'),Ot=m('<div class="error-message svelte-k8wt4x"> </div>'),Ct=m(`<div class="reflect-container svelte-k8wt4x"><h1 class="svelte-k8wt4x">New Reflection</h1> <div class="form-section svelte-k8wt4x"><h2 class="svelte-k8wt4x">How are you feeling?</h2> <div class="mood-selector svelte-k8wt4x"><div class="mood-tabs svelte-k8wt4x"><button>High Vibes</button> <button>Neutral</button> <button>Low Vibes</button></div> <div class="mood-options svelte-k8wt4x"></div></div></div> <div class="form-section svelte-k8wt4x"><h2 class="svelte-k8wt4x">Describe your moment</h2> <textarea placeholder="What's happening in this moment? How do you feel?" rows="4" class="svelte-k8wt4x"></textarea></div> <div class="form-section svelte-k8wt4x"><h2 class="svelte-k8wt4x">Tags</h2> <div class="tags-container svelte-k8wt4x"></div> <div class="custom-tag svelte-k8wt4x"><input type="text" placeholder="Add custom tag" class="svelte-k8wt4x"> <button class="svelte-k8wt4x">Add</button></div></div> <div class="form-section svelte-k8wt4x"><h2 class="svelte-k8wt4x">When did this happen?</h2> <div class="timestamp-selector svelte-k8wt4x"><label class="svelte-k8wt4x"><input type="radio" class="svelte-k8wt4x"> Now</label> <label class="svelte-k8wt4x"><input type="radio" class="svelte-k8wt4x"> Choose time</label> <!></div></div> <div class="form-section svelte-k8wt4x"><h2 class="svelte-k8wt4x">Voice Log (Optional)</h2> <div class="voice-recorder svelte-k8wt4x"><!></div></div> <!> <button class="submit-button svelte-k8wt4x"><!></button></div>`);function Xt(Fe,He){pt(He,!1);const[Ve,Be]=kt(),K=()=>ht(yt,"$authStore",Ve),Q={high:["Joy","Appreciation","Empowerment","Freedom","Love","Passion","Enthusiasm","Eagerness","Happiness","Positive Expectation","Belief","Optimism","Hopefulness","Contentment"],neutral:["Boredom","Pessimism","Frustration","Irritation","Impatience","Overwhelm","Disappointment","Doubt","Worry"],low:["Blame","Discouragement","Anger","Revenge","Hatred","Rage","Jealousy","Insecurity","Guilt","Unworthiness","Fear","Grief","Depression","Despair","Powerlessness"]},Ge=["Work","Family","Friends","Health","Relationship","Personal Growth","Finances","Creativity","Spirituality"];let p=c([]),P=c(""),f=c([]),D=c(""),U=c(new Date),g=c(!0),S=c(!1),T=null,X=[],k=c(null),_=c(null),H=c(0),E=null,x=c(null),V=c(!1),B=c(!1),G=c(!1),h=c(null),y=c("neutral");function We(t){e(p).indexOf(t)===-1?s(p,[...e(p),t]):s(p,e(p).filter(o=>o!==t))}function Ne(t){e(f).indexOf(t)===-1?s(f,[...e(f),t]):s(f,e(f).filter(o=>o!==t))}function xe(){e(D)&&!e(f).includes(e(D))&&(s(f,[...e(f),e(D)]),s(D,""))}function we(){s(g,!e(g)),e(g)&&s(U,new Date)}async function je(){try{const t=await navigator.mediaDevices.getUserMedia({audio:!0});T=new MediaRecorder(t),X=[],T.addEventListener("dataavailable",a=>{X.push(a.data)}),T.addEventListener("stop",()=>{s(k,new Blob(X,{type:"audio/webm"})),s(_,URL.createObjectURL(e(k))),s(S,!1),E&&(clearInterval(E),E=null)}),T.start(),s(S,!0),s(H,0),E=setInterval(()=>{s(H,e(H)+1)},1e3)}catch(t){console.error("Error starting recording:",t),s(S,!1)}}function Je(){T&&e(S)&&T.stop()}function qe(t){const a=Math.floor(t/60),o=t%60;return`${a}:${o.toString().padStart(2,"0")}`}async function be(){if(!(!e(k)||!e(_))){s(V,!0);try{const t=await St(e(_));t.success&&t.tone&&t.confidence&&s(x,{tone:t.tone,confidence:t.confidence})}catch(t){console.error("Error analyzing voice:",t)}finally{s(V,!1)}}}async function Ke(){if(K().user){if(e(p).length===0){s(h,"Please select at least one mood");return}if(!e(P).trim()){s(h,"Please enter a reflection");return}s(B,!0),s(h,null);try{let t="neutral";for(const l of e(p))if(Q.high.includes(l)){t="high";break}else if(Q.low.includes(l)){t="low";break}let a="";if(e(k)){const l=await Rt(K().user,e(k));l.success&&l.url&&(a=l.url,e(x)||await be())}const o={timestamp:e(U).toISOString(),mood:e(p),mood_level:t,text:e(P),tags:e(f),...a&&{audio_url:a},...e(x)&&{voice_insight:e(x)}};(await Dt(K().user,o)).success?(s(G,!0),setTimeout(()=>{s(p,[]),s(P,""),s(f,[]),s(U,new Date),s(g,!0),s(k,null),s(_,null),s(x,null),s(G,!1)},2e3)):s(h,"Failed to save reflection. Please try again.")}catch(t){console.error("Error submitting reflection:",t),s(h,"An unexpected error occurred. Please try again.")}finally{s(B,!1)}}}_t(()=>()=>{e(_)&&URL.revokeObjectURL(e(_)),E&&clearInterval(E)}),mt();var Y=Ct(),Z=r(n(Y),2),ge=r(n(Z),2),$=n(ge),ee=n($);let ke;var te=r(ee,2);let he;var ye=r(te,2);let Re;i($);var De=r($,2);Me(De,5,()=>Q[e(y)],Oe,(t,a)=>{var o=Tt();let w;var l=n(o,!0);i(o),R(d=>{w=F(o,1,"mood-chip svelte-k8wt4x",null,w,d),I(l,e(a))},[()=>({selected:e(p).includes(e(a))})],C),u("click",o,()=>We(e(a))),v(t,o)}),i(De),i(ge),i(Z);var se=r(Z,2),Se=r(n(se),2);bt(Se),i(se);var ae=r(se,2),oe=r(n(ae),2);Me(oe,5,()=>Ge,Oe,(t,a)=>{var o=Et();let w;var l=n(o,!0);i(o),R(d=>{w=F(o,1,"tag-chip svelte-k8wt4x",null,w,d),I(l,e(a))},[()=>({selected:e(f).includes(e(a))})],C),u("click",o,()=>Ne(e(a))),v(t,o)}),i(oe);var Te=r(oe,2),W=n(Te);q(W);var Qe=r(W,2);i(Te),i(ae);var re=r(ae,2),Ee=r(n(re),2),ie=n(Ee),le=n(ie);q(le),ze(),i(ie);var ne=r(ie,2),ce=n(ne);q(ce),ze(),i(ne);var Xe=r(ne,2);{var Ye=t=>{var a=Lt();q(a),_e(a,()=>e(U),o=>s(U,o)),v(t,a)};b(Xe,t=>{e(g)||t(Ye)})}i(Ee),i(re);var ve=r(re,2),Le=r(n(ve),2),Ze=n(Le);{var $e=t=>{var a=At();u("click",a,je),v(t,a)},et=(t,a)=>{{var o=l=>{var d=It(),z=wt(d),M=r(n(z));i(z);var O=r(z,2);R(j=>I(M,` Recording... ${j??""}`),[()=>qe(e(H))],C),u("click",O,Je),v(l,d)},w=(l,d)=>{{var z=M=>{var O=Mt(),j=n(O),Ie=r(j,2),rt=r(Ie,2);{var it=L=>{var J=Pt();u("click",J,be),v(L,J)},lt=(L,J)=>{{var nt=A=>{var ue=Ut();v(A,ue)},ct=(A,ue)=>{{var vt=de=>{var fe=zt(),me=n(fe),Pe=r(n(me)),ut=n(Pe,!0);i(Pe),i(me);var Ue=r(me,2),dt=n(Ue);i(Ue),i(fe),R(ft=>{I(ut,e(x).tone),I(dt,`Confidence: ${ft??""}%`)},[()=>Math.round(e(x).confidence*100)],C),v(de,fe)};b(A,de=>{e(x)&&de(vt)},ue)}};b(L,A=>{e(V)?A(nt):A(ct,!1)},J)}};b(rt,L=>{!e(x)&&!e(V)?L(it):L(lt,!1)})}i(O),R(()=>gt(j,"src",e(_))),u("click",Ie,()=>{s(_,null),s(k,null),s(x,null)}),v(M,O)};b(l,M=>{e(_)&&M(z)},d)}};b(t,l=>{e(S)?l(o):l(w,!1)},a)}};b(Ze,t=>{!e(S)&&!e(_)?t($e):t(et,!1)})}i(Le),i(ve);var Ae=r(ve,2);{var tt=t=>{var a=Ot(),o=n(a,!0);i(a),R(()=>I(o,e(h))),v(t,a)};b(Ae,t=>{e(h)&&t(tt)})}var N=r(Ae,2),st=n(N);{var at=t=>{var a=pe("Saving...");v(t,a)},ot=(t,a)=>{{var o=l=>{var d=pe("Saved!");v(l,d)},w=l=>{var d=pe("Log Reflection");v(l,d)};b(t,l=>{e(G)?l(o):l(w,!1)},a)}};b(st,t=>{e(B)?t(at):t(ot,!1)})}i(N),i(Y),R((t,a,o)=>{ke=F(ee,1,"svelte-k8wt4x",null,ke,t),he=F(te,1,"svelte-k8wt4x",null,he,a),Re=F(ye,1,"svelte-k8wt4x",null,Re,o),Ce(le,e(g)),Ce(ce,!e(g)),N.disabled=e(B)||e(G)},[()=>({active:e(y)==="high"}),()=>({active:e(y)==="neutral"}),()=>({active:e(y)==="low"})],C),u("click",ee,()=>s(y,"high")),u("click",te,()=>s(y,"neutral")),u("click",ye,()=>s(y,"low")),_e(Se,()=>e(P),t=>s(P,t)),_e(W,()=>e(D),t=>s(D,t)),u("keydown",W,t=>t.key==="Enter"&&xe()),u("click",Qe,xe),u("change",le,we),u("change",ce,we),u("click",N,Ke),v(Fe,Y),xt(),Be()}export{Xt as component};
