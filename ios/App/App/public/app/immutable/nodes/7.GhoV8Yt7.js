import{t as _,a as z}from"../chunks/B1TZXfti.js";import"../chunks/VBNCskEB.js";import{p as ze,b as _e,c as a,s as c,m as w,g as s,n as S,r as i,e as o,t as j,d as be}from"../chunks/CDb6m0PD.js";import{e as we,s as m}from"../chunks/CxWVBdvW.js";import{i as F}from"../chunks/Dm4goCkW.js";import{b as Se}from"../chunks/C1IXUDxN.js";import{i as xe}from"../chunks/CGS7UL4d.js";import{s as ke,a as q}from"../chunks/CbuS4uut.js";import{o as ye}from"../chunks/BOa5fj8P.js";import{p as De}from"../chunks/CX1IrXiN.js";import{g as N}from"../chunks/DXN4q5X4.js";import{a as Re}from"../chunks/3OU4Vcau.js";import{d as Be}from"../chunks/BERqu7mZ.js";import{u as He}from"../chunks/BXsTdfT2.js";var Ve=_('<div class="loading svelte-e8fm4z">Loading session details...</div>'),$e=_('<div class="error-message svelte-e8fm4z"> </div>'),Ee=_('<div class="session-info svelte-e8fm4z"><div class="session-header svelte-e8fm4z"><div class="session-date svelte-e8fm4z"> </div> <div class="session-time svelte-e8fm4z"> </div></div> <div class="stats-grid svelte-e8fm4z"><div class="stat-card svelte-e8fm4z"><div class="stat-label svelte-e8fm4z">Duration</div> <div class="stat-value svelte-e8fm4z"> </div></div> <div class="stat-card svelte-e8fm4z"><div class="stat-label svelte-e8fm4z">Avg Heart Rate</div> <div class="stat-value svelte-e8fm4z"> <span class="unit svelte-e8fm4z">bpm</span></div></div> <div class="stat-card svelte-e8fm4z"><div class="stat-label svelte-e8fm4z">Avg Balance</div> <div class="stat-value svelte-e8fm4z"> <span class="unit svelte-e8fm4z">ms</span></div></div> <div class="stat-card svelte-e8fm4z"><div class="stat-label svelte-e8fm4z">Vibe Score</div> <div class="stat-value svelte-e8fm4z"> </div></div></div> <div class="chart-section svelte-e8fm4z"><h2 class="svelte-e8fm4z">Session Data</h2> <div class="chart-container svelte-e8fm4z"></div> <div class="chart-legend svelte-e8fm4z"><div class="legend-item svelte-e8fm4z"><div class="legend-dot hr-dot svelte-e8fm4z"></div> <div class="legend-label svelte-e8fm4z">Heart Rate</div></div> <div class="legend-item svelte-e8fm4z"><div class="legend-dot rmssd-dot svelte-e8fm4z"></div> <div class="legend-label svelte-e8fm4z">Balance</div></div> <div class="legend-item svelte-e8fm4z"><div class="legend-dot vibe-dot svelte-e8fm4z"></div> <div class="legend-label svelte-e8fm4z">Vibe Score</div></div></div></div></div>'),Fe=_('<div class="error-message svelte-e8fm4z">Session not found</div>'),Le=_('<div class="hrv-detail-container svelte-e8fm4z"><div class="header svelte-e8fm4z"><button class="back-button svelte-e8fm4z"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-e8fm4z"><path d="M19 12H5M12 19l-7-7 7-7"></path></svg> Back</button> <h1 class="svelte-e8fm4z">HRV Session Details</h1></div> <!></div>');function Ke(W,G){ze(G,!1);const[L,J]=ke(),M=()=>q(Re,"$authStore",L),K=()=>q(De,"$page",L);let l=w(null),x=w(!0),g=w(null),n=w(),f=null;ye(async()=>{if(!M().user){N("/login");return}const e=K().url.searchParams.get("id");if(!e){c(g,"No session ID provided."),c(x,!1);return}try{const t=await Be(M().user,e);t.success&&t.session&&t.session.type==="hrv_session"?(c(l,t.session),setTimeout(()=>{s(n)&&s(l)&&Q()},100)):c(g,"Failed to load HRV session or session not found.")}catch(t){console.error("Error loading HRV session:",t),c(g,"An unexpected error occurred while loading the session.")}finally{c(x,!1)}});function Q(){if(!s(n)||!s(l)){console.error("Chart element or session data not found");return}const e=[],t=[],u=[],b=[];s(l).chart_data.forEach(r=>{const d=new Date(r.timestamp).getTime()/1e3;e.push(d),t.push(r.hr),u.push(r.rmssd),b.push(r.vibe)});const v={width:s(n).clientWidth,height:300,padding:[20,0,0,0],cursor:{show:!0,points:{show:!1},drag:{setScale:!1},focus:{prox:30}},legend:{show:!1},series:[{},{}],scales:{x:{time:!0},hr:{auto:!0,range:[40,180]},rmssd:{auto:!0,range:[0,100]},vibe:{auto:!0,range:[0,100]}},axes:[{},{scale:"hr",label:"Heart Rate (bpm)",labelSize:20,stroke:"rgba(229, 57, 53, 0.5)",grid:{show:!1}},{scale:"rmssd",label:"Balance (ms)",labelSize:20,stroke:"rgba(77, 68, 179, 0.5)",grid:{show:!1}},{scale:"vibe",label:"Vibe Score",labelSize:20,stroke:"rgba(191, 70, 154, 0.5)",grid:{show:!1}}]};try{f=new He(v,[e,t,u,b],s(n));const r=new ResizeObserver(d=>{f&&d[0]&&f.setSize({width:d[0].contentRect.width,height:300})});return r.observe(s(n)),()=>{f&&(f.destroy(),f=null),r.disconnect()}}catch(r){console.error("Error creating chart:",r)}}function X(e){return new Date(e).toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric",year:"numeric"})}function Y(e){return new Date(e).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}function Z(e){const t=Math.floor(e/60),u=e%60;return`${t}:${u.toString().padStart(2,"0")}`}function ee(){N("/history")}xe();var k=Le(),y=a(k),se=a(y);S(2),i(y);var te=o(y,2);{var ae=e=>{var t=Ve();z(e,t)},ie=(e,t)=>{{var u=v=>{var r=$e(),d=a(r,!0);i(r),j(()=>m(d,s(g))),z(v,r)},b=(v,r)=>{{var d=h=>{var p=Ee(),D=a(p),R=a(D),oe=a(R,!0);i(R);var T=o(R,2),le=a(T,!0);i(T),i(D);var B=o(D,2),H=a(B),A=o(a(H),2),ve=a(A,!0);i(A),i(H);var V=o(H,2),C=o(a(V),2),de=a(C);S(),i(C),i(V);var $=o(V,2),I=o(a($),2),ne=a(I);S(),i(I),i($);var O=o($,2),P=o(a(O),2),ce=a(P,!0);i(P),i(O),i(B);var U=o(B,2),me=o(a(U),2);Se(me,E=>c(n,E),()=>s(n)),S(2),i(U),i(p),j((E,fe,ue,he,ge,pe)=>{m(oe,E),m(le,fe),m(ve,ue),m(de,`${he??""} `),m(ne,`${ge??""} `),m(ce,pe)},[()=>X(s(l).timestamp),()=>Y(s(l).timestamp),()=>Z(s(l).duration_seconds),()=>s(l).avg_hr.toFixed(0),()=>s(l).avg_rmssd.toFixed(1),()=>s(l).vibe_score.toFixed(0)],be),z(h,p)},re=h=>{var p=Fe();z(h,p)};F(v,h=>{s(l)?h(d):h(re,!1)},r)}};F(e,v=>{s(g)?v(u):v(b,!1)},t)}};F(te,e=>{s(x)?e(ae):e(ie,!1)})}i(k),we("click",se,ee),z(W,k),_e(),J()}export{Ke as component};
