const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/CiNr0HXD.js","../chunks/DOsK5eWY.js","../chunks/Dp1pzeXC.js"])))=>i.map(i=>d[i]);
import{t as q,a as B,b as Ge}from"../chunks/CnvfDVfY.js";import"../chunks/Bz5RaRe3.js";import{p as Qt,at as bt,au as Xt,f as Zt,a as ea,s as g,m as E,c as t,g as e,b as s,r as a,n as be,y as X,t as fe,av as ta}from"../chunks/BqLDX34w.js";import{e as U,s as _}from"../chunks/Dnxtqdj9.js";import{i as O}from"../chunks/CR_S-Ndk.js";import{s as Z}from"../chunks/CW1jeaI7.js";import{s as _e}from"../chunks/DgItoWHB.js";import{t as Oe,f as Ne}from"../chunks/BRY9_-zS.js";import{b as aa}from"../chunks/DDvxHkRN.js";import{i as sa}from"../chunks/DIvFRTmL.js";import{s as na,a as ke}from"../chunks/DSKrvmxr.js";import{g as re,w as Ke,o as ra,a as ia}from"../chunks/DWFD33l1.js";import{g as qe}from"../chunks/Yt34wXNn.js";import{a as oa}from"../chunks/DrO-CEjc.js";import{D as la,i as ca,d as ft}from"../chunks/BAObU9c1.js";import{g as We,c as va,u as ua,M as Se}from"../chunks/hMCSdXjZ.js";import{i as da}from"../chunks/CGdVJ3Qh.js";import{_ as Je}from"../chunks/Dp1pzeXC.js";const we=()=>typeof window.Capacitor<"u";console.log("Environment check:",{isCapacitor:we(),hasWebBluetooth:typeof navigator<"u"&&"bluetooth"in navigator});const H=Ke({connected:!1,deviceName:"",deviceId:"",error:null,scanning:!1,batteryLevel:75}),ye=Ke({heartRate:0,rmssd:0,vibeScore:0,rrIntervals:[],chartData:[]}),N=Ke({startTime:0,currentTime:0,elapsedSeconds:0,isRunning:!1}),je=()=>we()?!0:typeof navigator<"u"&&"bluetooth"in navigator,ga=async()=>{var c;try{if(!je())throw new Error("Bluetooth is not supported on this device");if(H.update(n=>({...n,scanning:!0,error:null})),console.log("Starting BLE scan..."),we()){console.log("Using Capacitor BLE implementation");try{const{BleClient:n}=await Je(async()=>{const{BleClient:i}=await import("../chunks/CiNr0HXD.js");return{BleClient:i}},__vite__mapDeps([0,1,2]),import.meta.url);console.log("Initializing BLE client..."),await n.initialize();const r=await n.isEnabled();if(console.log("Bluetooth enabled:",r),!r)try{await n.enable(),console.log("Bluetooth enabled successfully")}catch(i){throw console.error("Failed to enable Bluetooth:",i),new Error("Please enable Bluetooth to connect to your device")}console.log("Requesting device...");const b=await n.requestDevice({services:["0000180d-0000-1000-8000-00805f9b34fb"],namePrefix:"Polar"});return console.log("Device selected:",b),await ha(b.deviceId,b.name||"Polar Device"),{success:!0}}catch(n){throw console.error("Capacitor BLE error:",n),n}}else{if(console.log("Using Web Bluetooth API implementation"),!("bluetooth"in navigator))throw new Error("Web Bluetooth is not supported in this browser");console.log("Requesting device...");const n=await navigator.bluetooth.requestDevice({filters:[{services:["heart_rate"]},{namePrefix:"Polar"}],optionalServices:["heart_rate"]});console.log("Device selected:",n.name),H.update(m=>({...m,deviceName:n.name||"Unknown Device",deviceId:n.id})),console.log("Connecting to GATT server...");const r=await((c=n.gatt)==null?void 0:c.connect());if(!r)throw new Error("Failed to connect to GATT server");console.log("Getting Heart Rate service...");const b=await r.getPrimaryService("heart_rate");console.log("Getting Heart Rate Measurement characteristic...");const i=await b.getCharacteristic("heart_rate_measurement");return console.log("Starting notifications..."),await i.startNotifications(),console.log("Adding event listener for heart rate measurements..."),i.addEventListener("characteristicvaluechanged",ma),H.update(m=>({...m,connected:!0,scanning:!1})),n.addEventListener("gattserverdisconnected",()=>{console.log("Device disconnected"),H.update(S=>({...S,connected:!1,error:new Error("Device disconnected")})),re(N).isRunning&&Qe()}),{success:!0}}}catch(n){return console.error("BLE scan error:",n),H.update(r=>({...r,scanning:!1,error:n instanceof Error?n:new Error("Unknown BLE error")})),{success:!1,error:n instanceof Error?n:new Error("Unknown BLE error")}}};async function ha(c,n){try{console.log("Connecting to Capacitor device:",c,n);const{BleClient:r}=await Je(async()=>{const{BleClient:m}=await import("../chunks/CiNr0HXD.js");return{BleClient:m}},__vite__mapDeps([0,1,2]),import.meta.url);console.log("Establishing connection..."),await r.connect(c),console.log("Connected successfully"),H.update(m=>({...m,deviceName:n,deviceId:c,connected:!0,scanning:!1}));const b="0000180d-0000-1000-8000-00805f9b34fb",i="00002a37-0000-1000-8000-00805f9b34fb";console.log("Starting notifications for heart rate..."),await r.startNotifications(c,b,i,m=>{const S=new DataView(m.buffer);pa(S)}),console.log("Notifications started successfully"),kt()}catch(r){console.error("Error connecting to Capacitor device:",r),H.update(b=>({...b,connected:!1,scanning:!1,error:r instanceof Error?r:new Error("Failed to connect to device")}))}}function pa(c){const n=c.getUint8(0),r=n&1,b=r?c.getUint16(1,!0):c.getUint8(1),i=[];if(n&16){const m=r?3:2;for(let S=m;S<c.byteLength;S+=2){const k=c.getUint16(S,!0)/1024*1e3;i.push(k)}}_t(b,i)}const ma=c=>{const n=c.target.value;if(!n)return;const r=n.getUint8(0),b=r&1,i=b?n.getUint16(1,!0):n.getUint8(1),m=[];if(r&16){const S=b?3:2;for(let k=S;k<n.byteLength;k+=2){const y=n.getUint16(k,!0)/1024*1e3;m.push(y)}}_t(i,m)},_t=(c,n)=>{ye.update(r=>{const i=[...r.rrIntervals,...n].slice(-64);let m=0;if(i.length>1){let V=0;for(let L=1;L<i.length;L++){const z=i[L]-i[L-1];V+=z*z}m=Math.sqrt(V/(i.length-1))}const k=re(N).isRunning?6:void 0,y=va(m,i,k),h=new Date().toISOString(),ee=[...r.chartData,{timestamp:h,hr:c,rmssd:m,vibe:y}].slice(-300);return{heartRate:c,rmssd:m,vibeScore:y,rrIntervals:i,chartData:ee}})},ze=async()=>{try{const c=re(H).deviceId;if(c&&we())try{const{BleClient:n}=await Je(async()=>{const{BleClient:r}=await import("../chunks/CiNr0HXD.js");return{BleClient:r}},__vite__mapDeps([0,1,2]),import.meta.url);await n.disconnect(c)}catch(n){console.error("Error disconnecting from Capacitor device:",n)}return H.set({connected:!1,deviceName:"",deviceId:"",error:null,scanning:!1,batteryLevel:75}),Ye(),Qe(),{success:!0}}catch(c){return console.error("BLE disconnect error:",c),{success:!1,error:c instanceof Error?c:new Error("Unknown BLE error")}}},Ye=()=>{ye.set({heartRate:0,rmssd:0,vibeScore:0,rrIntervals:[],chartData:[]})},kt=()=>{const c=Date.now();N.set({startTime:c,currentTime:c,elapsedSeconds:0,isRunning:!0});const n=setInterval(()=>{N.update(r=>{if(!r.isRunning)return clearInterval(n),r;const b=Date.now(),i=Math.floor((b-r.startTime)/1e3);return{...r,currentTime:b,elapsedSeconds:i}})},1e3)},Qe=()=>{N.update(c=>({...c,isRunning:!1}))},ba=()=>{const c=re(N),n=re(ye),r=n.chartData;let b=0,i=0,m=0;r.forEach(T=>{b+=T.hr,i+=T.rmssd,m+=T.vibe});const S=r.length?Math.round(b/r.length):0,k=r.length?Math.round(i/r.length*10)/10:0,y=r.length?Math.round(m/r.length):0,h=We(y);return{startTime:new Date(c.startTime).toISOString(),endTime:new Date(c.currentTime).toISOString(),durationSeconds:c.elapsedSeconds,avgHR:S,avgRMSSD:k,avgVibe:y,vibeInterpretation:h,chartData:r,rrIntervals:n.rrIntervals}};var fa=q('<div class="error-message svelte-1e38nkl"> </div>'),_a=q('<div class="compatibility-warning svelte-1e38nkl"><p class="svelte-1e38nkl">Bluetooth is not supported on this device.</p> <p class="svelte-1e38nkl">Please use a device with Bluetooth support or the mobile app.</p></div>'),ka=q(`<div class="start-session svelte-1e38nkl"><p class="instructions svelte-1e38nkl">Connect your Polar H10 heart rate monitor to begin tracking your heart rate variability
				(HRV). This will help calculate your Vibe Score and track your physiological balance.</p> <!> <button class="start-button svelte-1e38nkl">Connect to Polar H10</button> <!></div>`),Sa=q('<div class="session-active svelte-1e38nkl"><div class="device-status svelte-1e38nkl"><div class="connection-status svelte-1e38nkl"><span></span> <span class="svelte-1e38nkl"> </span></div> <div class="battery-indicator svelte-1e38nkl"><div><div class="battery-level svelte-1e38nkl"></div></div> <span class="battery-text svelte-1e38nkl"> </span></div></div> <div class="metrics-grid svelte-1e38nkl"><button class="metric-tile svelte-1e38nkl" aria-label="Heart Rate Information"><h3 class="svelte-1e38nkl">Heart Rate</h3> <p class="value svelte-1e38nkl"> <span class="unit svelte-1e38nkl">BPM</span></p> <!></button> <button class="metric-tile svelte-1e38nkl" aria-label="Balance Information"><h3 class="svelte-1e38nkl">Balance</h3> <p class="value svelte-1e38nkl"> <span class="unit svelte-1e38nkl">ms</span></p> <!></button> <button class="metric-tile svelte-1e38nkl" aria-label="Session Time Information"><h3 class="svelte-1e38nkl">Time</h3> <p class="value svelte-1e38nkl"> </p> <!></button> <button class="metric-tile vibe-tile svelte-1e38nkl" aria-label="Vibe Score Information"><h3 class="svelte-1e38nkl">Vibe Score</h3> <p class="value svelte-1e38nkl"> </p> <!></button></div> <div class="chart-section svelte-1e38nkl"><h3 class="mb-2 text-xl font-semibold svelte-1e38nkl">Real-time HRV Data</h3> <div class="chart-container svelte-1e38nkl"></div> <div class="unified-legend svelte-1e38nkl"><div class="legend-item svelte-1e38nkl"><div class="legend-dot hr-dot svelte-1e38nkl"></div> <span class="legend-label svelte-1e38nkl">Heart Rate</span> <span> </span></div> <div class="legend-item svelte-1e38nkl"><div class="legend-dot rmssd-dot svelte-1e38nkl"></div> <span class="legend-label svelte-1e38nkl">Balance</span> <span> </span></div> <div class="legend-item svelte-1e38nkl"><div class="legend-dot vibe-dot svelte-1e38nkl"></div> <span class="legend-label svelte-1e38nkl">Vibe Score</span> <span> </span></div></div> <div class="vibe-score-container svelte-1e38nkl"><div class="vibe-score-circle-wrapper svelte-1e38nkl"><div class="glow-aura svelte-1e38nkl"></div> <div class="vibe-score-circle svelte-1e38nkl"><div class="vibe-score-value svelte-1e38nkl"> </div> <div class="vibe-score-label svelte-1e38nkl">Vibe Score</div></div></div> <div class="vibe-score-interpretation svelte-1e38nkl"><div class="interpretation-emoji svelte-1e38nkl"> </div> <div class="interpretation-text svelte-1e38nkl"> </div></div></div></div> <div class="breathing-guide-section svelte-1e38nkl"><h3 class="mb-3 text-xl font-semibold svelte-1e38nkl">Breathing Guide</h3> <p class="mb-3 text-sm text-gray-500 svelte-1e38nkl">Follow the rhythm</p> <div class="breathing-guide-container svelte-1e38nkl"><div class="breathing-pulse-ring svelte-1e38nkl"></div> <div><div class="breathing-text svelte-1e38nkl"> </div> <div class="breathing-timer svelte-1e38nkl"> </div></div> <div class="breathing-ripple svelte-1e38nkl"></div></div></div> <div class="button-container svelte-1e38nkl"><button class="stop-button svelte-1e38nkl">Stop Session</button></div></div>'),wa=q('<div class="error-message svelte-1e38nkl"> </div>'),ya=q('<div class="modal-overlay svelte-1e38nkl"><div class="summary-modal svelte-1e38nkl"><h2 class="svelte-1e38nkl">Session Summary</h2> <div class="summary-stats svelte-1e38nkl"><div class="summary-stat svelte-1e38nkl"><span class="stat-label svelte-1e38nkl">Duration</span> <span class="stat-value svelte-1e38nkl"> </span></div> <div class="summary-stat svelte-1e38nkl"><span class="stat-label svelte-1e38nkl">Avg Heart Rate</span> <span class="stat-value svelte-1e38nkl"> </span></div> <div class="summary-stat svelte-1e38nkl"><span class="stat-label svelte-1e38nkl">Avg Balance (RMSSD)</span> <span class="stat-value svelte-1e38nkl"> </span></div> <div class="summary-stat svelte-1e38nkl"><span class="stat-label svelte-1e38nkl">Vibe Score</span> <span class="stat-value svelte-1e38nkl"> </span></div></div> <!> <div class="summary-actions svelte-1e38nkl"><button class="save-button svelte-1e38nkl"><!></button> <button class="discard-button svelte-1e38nkl">Discard Session</button></div></div></div>'),Da=q('<div class="hrv-session-container svelte-1e38nkl"><!> <!></div> <!>',1);function Na(c,n){Qt(n,!1);const[r,b]=na(),i=()=>ke(ye,"$hrvData",r),m=()=>ke(N,"$sessionTimer",r),S=()=>ke(oa,"$authStore",r),k=()=>ke(H,"$bleConnectionStatus",r);let y=E(),h=null,T=E("inhale"),ee=E(0),V=null,L=E(!1),z=E(!1),w=E(null),W=E(null),te=E(null),ae=E(!1),ie=E(!1),A=E({hr:"-",rmssd:"-",vibe:"-"}),De=E(We(0)),C=E(null);const f={heartRate:{title:"Heart Rate",explanation:"Your heart beats per minute.",hint:"Normal resting range is 60-100 BPM.",stateDescription:"Lower heart rate during rest often indicates better cardiovascular health.",suggestion:"Focus on your breath to help regulate your heart rate."},balance:{title:"Balance",explanation:"Your nervous system is relaxing between beats.",hint:"Measured in milliseconds of variation between heartbeats.",stateDescription:"Higher = more emotional flexibility and calm.",suggestion:"Keep breathing gently â€“ this is a good sign."},vibeScore:{title:"Vibe Score",explanation:"A measure of your overall physiological balance.",hint:"Combines heart rate variability, breathing patterns, and rhythm.",stateDescription:"Higher scores reflect a state of calm awareness and inner balance.",suggestion:"Notice what helps your score rise and fall."},time:{title:"Session Time",explanation:"Duration of your current session.",hint:"",stateDescription:"Even short sessions of 3-5 minutes can be beneficial.",suggestion:"Try to practice regularly rather than focusing on length."}};async function oe(o){await ta(),requestAnimationFrame(()=>{e(C)===o?g(C,null):g(C,o)})}function Xe(){if(!e(y))return console.error("Chart element not found"),null;console.log("Initializing chart with element:",e(y));const o={width:e(y).clientWidth,height:240,padding:[20,0,0,0],cursor:{show:!0,points:{show:!1},drag:{setScale:!1},focus:{prox:30},dataIdx:(d,v,u)=>{if(u!==null){const l=d.data;g(A,{hr:l[1][u]!==null?l[1][u].toFixed(0)+" bpm":"-",rmssd:l[2][u]!==null?l[2][u].toFixed(1)+" ms":"-",vibe:l[3][u]!==null?l[3][u].toFixed(0):"-"})}return u}},legend:{show:!1},series:[{},{scale:"hr",label:"Heart Rate",value:(d,v)=>v==null?"-":v.toFixed(0)+" bpm",stroke:"rgba(229, 57, 53, 0.8)",width:2,points:{show:!1},spanGaps:!0},{scale:"rmssd",label:"Balance",value:(d,v)=>v==null?"-":v.toFixed(1)+" ms",stroke:"rgba(77, 68, 179, 0.8)",width:2,points:{show:!1},spanGaps:!0},{scale:"vibe",label:"Vibe Score",value:(d,v)=>v==null?"-":v.toFixed(0),stroke:"rgba(191, 70, 154, 0.8)",width:2,points:{show:!1},spanGaps:!0}],scales:{x:{time:!0,auto:!1,range:(d,v,u)=>{const l=Date.now()/1e3;return[l-120,l]}},hr:{auto:!0,range:[40,180]},rmssd:{auto:!0,range:[0,100]},vibe:{auto:!0,range:[0,100]}},axes:[]};try{console.log("Creating uPlot instance with options:",o),h=new ua(o,[[],[],[],[]],e(y)),console.log("Chart created successfully:",h),h&&h.hooks&&h.hooks.setData&&h.hooks.setData.push(()=>{var d,v,u;if(h){const l=h.data[0].length-1;l>=0&&g(A,{hr:h.data[1][l]!==null?(((d=h.data[1][l])==null?void 0:d.toString())||"-")+" bpm":"-",rmssd:h.data[2][l]!==null?(((v=h.data[2][l])==null?void 0:v.toString())||"-")+" ms":"-",vibe:h.data[3][l]!==null&&((u=h.data[3][l])==null?void 0:u.toString())||"-"})}})}catch(d){return console.error("Error creating chart:",d),null}const p=new ResizeObserver(d=>{h&&d[0]&&h.setSize({width:d[0].contentRect.width,height:240})});return p.observe(e(y)),()=>{h&&(h.destroy(),h=null),p.disconnect()}}function St(){if(!h)if(console.warn("Cannot update chart: chart instance is null"),e(y)&&!h){if(console.log("Attempting to reinitialize chart..."),Xe(),!h)return}else return;const o=i().chartData;if(o.length===0){console.log("No chart data available yet");return}console.log("Updating chart with data points:",o.length);const p=o.map(l=>new Date(l.timestamp).getTime()/1e3),d=o.map(l=>l.hr),v=o.map(l=>l.rmssd),u=o.map(l=>l.vibe);try{h.setData([p,d,v,u]),console.log("Chart updated successfully")}catch(l){console.error("Error updating chart:",l)}}function wt(){let v="inhale",u=0,l=Date.now();V=setInterval(()=>{const P=Date.now(),D=P-l;l=P,v==="inhale"?(u+=D/4e3*100,u>=100&&(u=0,v="exhale")):(u+=D/6e3*100,u>=100&&(u=0,v="inhale")),g(T,v),g(ee,u)},16)}function Ze(){V&&(clearInterval(V),V=null)}async function yt(){var o;if(g(W,null),!je()){g(W,"Bluetooth is not supported on this device. Please use a device with Bluetooth support.");return}try{const p=await ga();p.success?(m().isRunning||kt(),wt(),Ye(),g(L,!0)):g(W,((o=p.error)==null?void 0:o.message)||"Failed to connect to device.")}catch(p){console.error("Error starting session:",p),g(W,p instanceof Error?p.message:"An unknown error occurred.")}}async function Dt(){if(!(!S().user||!e(w))){g(ae,!0),g(te,null);try{const o={timestamp:new Date().toISOString(),start:e(w).startTime,end:e(w).endTime,duration_seconds:e(w).durationSeconds,avg_hr:e(w).avgHR,avg_rmssd:e(w).avgRMSSD,vibe_score:e(w).avgVibe,vibe_interpretation:e(w).vibeInterpretation,chart_data:e(w).chartData,rr_intervals:e(w).rrIntervals};if((await da(S().user,o)).success)if(g(ie,!0),await ca(S().user)){const v=ft.showRandomTool();v&&await ft.logToolInteraction(S().user,v.id,"shown")}else setTimeout(()=>{qe("/history")},2e3);else g(te,"Failed to save HRV session. Please try again.")}catch(o){console.error("Error saving HRV session:",o),g(te,"An unexpected error occurred. Please try again.")}finally{g(ae,!1)}}}function xt(){Qe(),Ze(),g(w,ba()),g(z,!0)}function Rt(){Ye(),g(L,!1),g(z,!1),g(w,null),ze(),qe("/home")}function et(o){const p=Math.floor(o/60),d=o%60;return`${p}:${d.toString().padStart(2,"0")}`}ra(()=>{const o=Xe();return()=>{o==null||o(),Ze(),ze()}}),ia(()=>{V&&clearInterval(V),ze()}),bt(()=>i(),()=>{g(De,We(i().vibeScore))}),bt(()=>i(),()=>{i().chartData.length>0&&(console.log("HRV data updated, chart data points:",i().chartData.length),St())}),Xt(),sa();var tt=Da(),xe=Zt(tt),at=t(xe);{var Et=o=>{var p=ka(),d=s(t(p),2);{var v=D=>{var I=fa(),M=t(I,!0);a(I),fe(()=>_(M,e(W))),B(D,I)};O(d,D=>{e(W)&&D(v)})}var u=s(d,2),l=s(u,2);{var P=D=>{var I=_a();B(D,I)};O(l,D=>{je()||D(P)})}a(p),U("click",u,yt),B(o,p)},Tt=o=>{var p=Sa(),d=t(p),v=t(d),u=t(v);let l;var P=s(u,2),D=t(P,!0);a(P),a(v);var I=s(v,2),M=t(I);let j;var le=t(M);a(M);var ce=s(M,2),ve=t(ce);a(ce),a(I),a(d);var Y=s(d,2),K=t(Y),J=s(t(K),2),Re=t(J);be(),a(J);var ue=s(J,2);const F=X(()=>e(C)==="heartRate");Se(ue,{get isVisible(){return e(F)},onClose:()=>g(C,null),get title(){return f.heartRate.title},get explanation(){return f.heartRate.explanation},get hint(){return f.heartRate.hint},get stateDescription(){return f.heartRate.stateDescription},get suggestion(){return f.heartRate.suggestion}}),a(K);var Q=s(K,2),se=s(t(Q),2),Ee=t(se);be(),a(se);var de=s(se,2);const x=X(()=>e(C)==="balance");Se(de,{get isVisible(){return e(x)},onClose:()=>g(C,null),get title(){return f.balance.title},get explanation(){return f.balance.explanation},get hint(){return f.balance.hint},get stateDescription(){return f.balance.stateDescription},get suggestion(){return f.balance.suggestion}}),a(Q);var R=s(Q,2),G=s(t(R),2),Te=t(G,!0);a(G);var $=s(G,2);const ne=X(()=>e(C)==="time");Se($,{get isVisible(){return e(ne)},onClose:()=>g(C,null),get title(){return f.time.title},get explanation(){return f.time.explanation},get hint(){return f.time.hint},get stateDescription(){return f.time.stateDescription},get suggestion(){return f.time.suggestion}}),a(R);var Ce=s(R,2),Ie=s(t(Ce),2),Ht=t(Ie,!0);a(Ie);var Vt=s(Ie,2);const Pt=X(()=>e(C)==="vibeScore");Se(Vt,{get isVisible(){return e(Pt)},onClose:()=>g(C,null),get title(){return f.vibeScore.title},get explanation(){return f.vibeScore.explanation},get hint(){return f.vibeScore.hint},get stateDescription(){return f.vibeScore.stateDescription},get suggestion(){return f.vibeScore.suggestion}}),a(Ce),a(Y);var Be=s(Y,2),st=s(t(Be),2);aa(st,Fe=>g(y,Fe),()=>e(y));var He=s(st,2),Ve=t(He),ge=s(t(Ve),4);let nt;var Lt=t(ge,!0);a(ge),a(Ve);var Pe=s(Ve,2),he=s(t(Pe),4);let rt;var At=t(he,!0);a(he),a(Pe);var it=s(Pe,2),pe=s(t(it),4);let ot;var Mt=t(pe,!0);a(pe),a(it),a(He);var lt=s(He,2),Le=t(lt),ct=t(Le),Ae=s(ct,2),vt=t(Ae),$t=t(vt,!0);a(vt),be(2),a(Ae),a(Le);var ut=s(Le,2),Me=t(ut),Ut=t(Me,!0);a(Me);var dt=s(Me,2),Ft=t(dt,!0);a(dt),a(ut),a(lt),a(Be);var $e=s(Be,2),gt=s(t($e),4),me=s(t(gt),2);let ht;var Ue=t(me),Gt=t(Ue,!0);a(Ue);var pt=s(Ue,2),Ot=t(pt,!0);a(pt),a(me),be(2),a(gt),a($e);var mt=s($e,2),Nt=t(mt);a(mt),a(p),fe((Fe,qt,zt,Wt,jt,Yt,Kt,Jt)=>{l=Z(u,1,"status-indicator svelte-1e38nkl",null,l,Fe),_(D,k().connected?`Connected to Polar H10 ${k().deviceId||""}`:"Disconnected"),j=Z(M,1,"battery-icon svelte-1e38nkl",null,j,qt),_e(le,`width: ${k().batteryLevel??""}%`),_(ve,`${k().batteryLevel??""}%`),_(Re,`${i().heartRate??""} `),_(Ee,`${zt??""} `),_(Te,Wt),_(Ht,i().vibeScore),nt=Z(ge,1,"legend-value svelte-1e38nkl",null,nt,jt),_(Lt,e(A).hr),rt=Z(he,1,"legend-value svelte-1e38nkl",null,rt,Yt),_(At,e(A).rmssd),ot=Z(pe,1,"legend-value svelte-1e38nkl",null,ot,Kt),_(Mt,e(A).vibe),_e(ct,`--intensity: ${i().vibeScore/100}`),_e(Ae,`--progress: ${i().vibeScore??""}%`),_($t,i().vibeScore),_(Ut,e(De).emoji),_(Ft,e(De).label),ht=Z(me,1,"breathing-circle svelte-1e38nkl",null,ht,Jt),_e(me,`transform: scale(${e(T)==="inhale"?.4+e(ee)/100*.6:1-e(ee)/100*.8})`),_(Gt,e(T)==="inhale"?"In":"Out"),_(Ot,e(T)==="inhale"?"4s":"6s")},[()=>({connected:k().connected}),()=>({"battery-low":k().batteryLevel<20,"battery-mid":k().batteryLevel>=20&&k().batteryLevel<50,"battery-full":k().batteryLevel>=50}),()=>i().rmssd.toFixed(1),()=>et(m().elapsedSeconds),()=>({"has-value":e(A).hr!=="-"}),()=>({"has-value":e(A).rmssd!=="-"}),()=>({"has-value":e(A).vibe!=="-"}),()=>({inhale:e(T)==="inhale",exhale:e(T)==="exhale"})],X),U("mousedown",K,()=>oe("heartRate")),U("mousedown",Q,()=>oe("balance")),U("mousedown",R,()=>oe("time")),U("mousedown",Ce,()=>oe("vibeScore")),Oe(1,ge,()=>Ne,()=>({duration:150})),Oe(1,he,()=>Ne,()=>({duration:150})),Oe(1,pe,()=>Ne,()=>({duration:150})),U("click",Nt,xt),B(o,p)};O(at,o=>{e(L)?o(Tt,!1):o(Et)})}var Ct=s(at,2);{var It=o=>{var p=ya(),d=t(p),v=s(t(d),2),u=t(v),l=s(t(u),2),P=t(l,!0);a(l),a(u);var D=s(u,2),I=s(t(D),2),M=t(I);a(I),a(D);var j=s(D,2),le=s(t(j),2),ce=t(le);a(le),a(j);var ve=s(j,2),Y=s(t(ve),2),K=t(Y,!0);a(Y),a(ve),a(v);var J=s(v,2);{var Re=x=>{var R=wa(),G=t(R,!0);a(R),fe(()=>_(G,e(te))),B(x,R)};O(J,x=>{e(te)&&x(Re)})}var ue=s(J,2),F=t(ue),Q=t(F);{var se=x=>{var R=Ge("Saving...");B(x,R)},Ee=(x,R)=>{{var G=$=>{var ne=Ge("Saved!");B($,ne)},Te=$=>{var ne=Ge("Save Session");B($,ne)};O(x,$=>{e(ie)?$(G):$(Te,!1)},R)}};O(Q,x=>{e(ae)?x(se):x(Ee,!1)})}a(F);var de=s(F,2);a(ue),a(d),a(p),fe((x,R)=>{_(P,x),_(M,`${e(w).avgHR??""} bpm`),_(ce,`${R??""} ms`),_(K,e(w).avgVibe),F.disabled=e(ae)||e(ie),de.disabled=e(ae)||e(ie)},[()=>et(e(w).durationSeconds),()=>e(w).avgRMSSD.toFixed(1)],X),U("click",F,Dt),U("click",de,Rt),B(o,p)};O(Ct,o=>{e(z)&&e(w)&&o(It)})}a(xe);var Bt=s(xe,2);la(Bt,{onClose:()=>qe("/history")}),B(c,tt),ea(),b()}export{Na as component};
