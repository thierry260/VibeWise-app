const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/CiNr0HXD.js","../chunks/DOsK5eWY.js","../chunks/Dp1pzeXC.js"])))=>i.map(i=>d[i]);
import{t as N,a as H,b as Ge}from"../chunks/CN_4Jffs.js";import"../chunks/C_EceCEL.js";import{p as Qt,ao as mt,ap as Xt,ac as Zt,b as ea,s as h,m as T,e as s,c as t,g as e,r as a,n as me,d as X,t as fe,aq as ta}from"../chunks/C32UjKbq.js";import{e as U,s as _}from"../chunks/HXctbdJI.js";import{i as O}from"../chunks/CdUhBWiK.js";import{s as Z}from"../chunks/COLsQU9v.js";import{s as _e}from"../chunks/Dt69Yfj7.js";import{t as Oe,f as qe}from"../chunks/yTN_rkYQ.js";import{b as aa}from"../chunks/WEtHXLpi.js";import{i as sa}from"../chunks/BT-A8O5u.js";import{s as ra,a as Se}from"../chunks/D2OzG1jj.js";import{g as ie,w as Ke,o as ia,a as na}from"../chunks/D1wvVs1Z.js";import{g as Ne}from"../chunks/C028ppxN.js";import{a as oa}from"../chunks/DxcAzl92.js";import{D as la,i as ca,d as ft}from"../chunks/BtggnnAo.js";import{g as We,c as va,u as da,M as we}from"../chunks/DimFh-gf.js";import{i as ua}from"../chunks/L29Sq4FH.js";import{_ as Je}from"../chunks/Dp1pzeXC.js";const ye=()=>typeof window.Capacitor<"u";console.log("Environment check:",{isCapacitor:ye(),hasWebBluetooth:typeof navigator<"u"&&"bluetooth"in navigator});const V=Ke({connected:!1,deviceName:"",deviceId:"",error:null,scanning:!1,batteryLevel:75}),De=Ke({heartRate:0,rmssd:0,vibeScore:0,rrIntervals:[],chartData:[]}),q=Ke({startTime:0,currentTime:0,elapsedSeconds:0,isRunning:!1}),je=()=>ye()?!0:typeof navigator<"u"&&"bluetooth"in navigator,ha=async()=>{var c;try{if(!je())throw new Error("Bluetooth is not supported on this device");if(V.update(r=>({...r,scanning:!0,error:null})),console.log("Starting BLE scan..."),ye()){console.log("Using Capacitor BLE implementation");try{const{BleClient:r}=await Je(async()=>{const{BleClient:n}=await import("../chunks/CiNr0HXD.js");return{BleClient:n}},__vite__mapDeps([0,1,2]),import.meta.url);console.log("Initializing BLE client..."),await r.initialize();const i=await r.isEnabled();if(console.log("Bluetooth enabled:",i),!i)try{await r.enable(),console.log("Bluetooth enabled successfully")}catch(n){throw console.error("Failed to enable Bluetooth:",n),new Error("Please enable Bluetooth to connect to your device")}console.log("Requesting device...");const m=await r.requestDevice({services:["0000180d-0000-1000-8000-00805f9b34fb"],namePrefix:"Polar"});return console.log("Device selected:",m),await ba(m.deviceId,m.name||"Polar Device"),{success:!0}}catch(r){throw console.error("Capacitor BLE error:",r),r}}else{if(console.log("Using Web Bluetooth API implementation"),!("bluetooth"in navigator))throw new Error("Web Bluetooth is not supported in this browser");console.log("Requesting device...");const r=await navigator.bluetooth.requestDevice({filters:[{services:["heart_rate"]},{namePrefix:"Polar"}],optionalServices:["heart_rate"]});console.log("Device selected:",r.name),V.update(p=>({...p,deviceName:r.name||"Unknown Device",deviceId:r.id})),console.log("Connecting to GATT server...");const i=await((c=r.gatt)==null?void 0:c.connect());if(!i)throw new Error("Failed to connect to GATT server");console.log("Getting Heart Rate service...");const m=await i.getPrimaryService("heart_rate");console.log("Getting Heart Rate Measurement characteristic...");const n=await m.getCharacteristic("heart_rate_measurement");return console.log("Starting notifications..."),await n.startNotifications(),console.log("Adding event listener for heart rate measurements..."),n.addEventListener("characteristicvaluechanged",pa),V.update(p=>({...p,connected:!0,scanning:!1})),r.addEventListener("gattserverdisconnected",()=>{console.log("Device disconnected"),V.update(w=>({...w,connected:!1,error:new Error("Device disconnected")})),ie(q).isRunning&&Qe()}),{success:!0}}}catch(r){return console.error("BLE scan error:",r),V.update(i=>({...i,scanning:!1,error:r instanceof Error?r:new Error("Unknown BLE error")})),{success:!1,error:r instanceof Error?r:new Error("Unknown BLE error")}}};async function ba(c,r){try{console.log("Connecting to Capacitor device:",c,r);const{BleClient:i}=await Je(async()=>{const{BleClient:p}=await import("../chunks/CiNr0HXD.js");return{BleClient:p}},__vite__mapDeps([0,1,2]),import.meta.url);console.log("Establishing connection..."),await i.connect(c),console.log("Connected successfully"),V.update(p=>({...p,deviceName:r,deviceId:c,connected:!0,scanning:!1}));const m="0000180d-0000-1000-8000-00805f9b34fb",n="00002a37-0000-1000-8000-00805f9b34fb";console.log("Starting notifications for heart rate..."),await i.startNotifications(c,m,n,p=>{const w=new DataView(p.buffer);ga(w)}),console.log("Notifications started successfully"),St()}catch(i){console.error("Error connecting to Capacitor device:",i),V.update(m=>({...m,connected:!1,scanning:!1,error:i instanceof Error?i:new Error("Failed to connect to device")}))}}function ga(c){const r=c.getUint8(0),i=r&1,m=i?c.getUint16(1,!0):c.getUint8(1),n=[];if(r&16){const p=i?3:2;for(let w=p;w<c.byteLength;w+=2){const S=c.getUint16(w,!0)/1024*1e3;n.push(S)}}_t(m,n)}const pa=c=>{const r=c.target.value;if(!r)return;const i=r.getUint8(0),m=i&1,n=m?r.getUint16(1,!0):r.getUint8(1),p=[];if(i&16){const w=m?3:2;for(let S=w;S<r.byteLength;S+=2){const D=r.getUint16(S,!0)/1024*1e3;p.push(D)}}_t(n,p)},_t=(c,r)=>{De.update(i=>{const n=[...i.rrIntervals,...r].slice(-64);let p=0;if(n.length>1){let P=0;for(let A=1;A<n.length;A++){const z=n[A]-n[A-1];P+=z*z}p=Math.sqrt(P/(n.length-1))}const S=ie(q).isRunning?6:void 0,D=va(p,n,S),b=new Date().toISOString(),ee=[...i.chartData,{timestamp:b,hr:c,rmssd:p,vibe:D}].slice(-300);return{heartRate:c,rmssd:p,vibeScore:D,rrIntervals:n,chartData:ee}})},ze=async()=>{try{const c=ie(V).deviceId;if(c&&ye())try{const{BleClient:r}=await Je(async()=>{const{BleClient:i}=await import("../chunks/CiNr0HXD.js");return{BleClient:i}},__vite__mapDeps([0,1,2]),import.meta.url);await r.disconnect(c)}catch(r){console.error("Error disconnecting from Capacitor device:",r)}return V.set({connected:!1,deviceName:"",deviceId:"",error:null,scanning:!1,batteryLevel:75}),Ye(),Qe(),{success:!0}}catch(c){return console.error("BLE disconnect error:",c),{success:!1,error:c instanceof Error?c:new Error("Unknown BLE error")}}},Ye=()=>{De.set({heartRate:0,rmssd:0,vibeScore:0,rrIntervals:[],chartData:[]})},St=()=>{const c=Date.now();q.set({startTime:c,currentTime:c,elapsedSeconds:0,isRunning:!0});const r=setInterval(()=>{q.update(i=>{if(!i.isRunning)return clearInterval(r),i;const m=Date.now(),n=Math.floor((m-i.startTime)/1e3);return{...i,currentTime:m,elapsedSeconds:n}})},1e3)},Qe=()=>{q.update(c=>({...c,isRunning:!1}))},ma=()=>{const c=ie(q),r=ie(De),i=r.chartData;let m=0,n=0,p=0;i.forEach(C=>{m+=C.hr,n+=C.rmssd,p+=C.vibe});const w=i.length?Math.round(m/i.length):0,S=i.length?Math.round(n/i.length*10)/10:0,D=i.length?Math.round(p/i.length):0,b=We(D);return{startTime:new Date(c.startTime).toISOString(),endTime:new Date(c.currentTime).toISOString(),durationSeconds:c.elapsedSeconds,avgHR:w,avgRMSSD:S,avgVibe:D,vibeInterpretation:b,chartData:i,rrIntervals:r.rrIntervals}};var fa=N('<div class="error-message svelte-13l5hib"> </div>'),_a=N('<div class="compatibility-warning svelte-13l5hib"><p class="svelte-13l5hib">Bluetooth is not supported on this device.</p> <p class="svelte-13l5hib">Please use a device with Bluetooth support or the mobile app.</p></div>'),Sa=N(`<div class="start-session svelte-13l5hib"><p class="instructions svelte-13l5hib">Connect your Polar H10 heart rate monitor to begin tracking your heart rate variability
				(HRV). This will help calculate your Vibe Score and track your physiological balance.</p> <!> <button class="start-button svelte-13l5hib">Connect to Polar H10</button> <!></div>`),wa=N('<div class="session-active svelte-13l5hib"><div class="device-status svelte-13l5hib"><div class="connection-status svelte-13l5hib"><span></span> <span class="svelte-13l5hib"> </span></div> <div class="battery-indicator svelte-13l5hib"><div><div class="battery-level svelte-13l5hib"></div></div> <span class="battery-text svelte-13l5hib"> </span></div></div> <div class="metrics-grid svelte-13l5hib"><button class="metric-tile svelte-13l5hib" aria-label="Heart Rate Information"><h3 class="svelte-13l5hib">Heart Rate</h3> <p class="value svelte-13l5hib"> <span class="unit svelte-13l5hib">BPM</span></p> <!></button> <button class="metric-tile svelte-13l5hib" aria-label="Balance Information"><h3 class="svelte-13l5hib">Balance</h3> <p class="value svelte-13l5hib"> <span class="unit svelte-13l5hib">ms</span></p> <!></button> <button class="metric-tile svelte-13l5hib" aria-label="Session Time Information"><h3 class="svelte-13l5hib">Time</h3> <p class="value svelte-13l5hib"> </p> <!></button> <button class="metric-tile vibe-tile svelte-13l5hib" aria-label="Vibe Score Information"><h3 class="svelte-13l5hib">Vibe Score</h3> <p class="value svelte-13l5hib"> </p> <!></button></div> <div class="chart-section svelte-13l5hib"><h3 class="mb-2 text-xl font-semibold svelte-13l5hib">Real-time HRV Data</h3> <div class="chart-container svelte-13l5hib"></div> <div class="unified-legend svelte-13l5hib"><div class="legend-item svelte-13l5hib"><div class="legend-dot hr-dot svelte-13l5hib"></div> <span class="legend-label svelte-13l5hib">Heart Rate</span> <span> </span></div> <div class="legend-item svelte-13l5hib"><div class="legend-dot rmssd-dot svelte-13l5hib"></div> <span class="legend-label svelte-13l5hib">Balance</span> <span> </span></div> <div class="legend-item svelte-13l5hib"><div class="legend-dot vibe-dot svelte-13l5hib"></div> <span class="legend-label svelte-13l5hib">Vibe Score</span> <span> </span></div></div> <div class="vibe-score-container svelte-13l5hib"><div class="vibe-score-circle-wrapper svelte-13l5hib"><div class="glow-aura svelte-13l5hib"></div> <div class="vibe-score-circle svelte-13l5hib"><div class="vibe-score-value svelte-13l5hib"> </div> <div class="vibe-score-label svelte-13l5hib">Vibe Score</div></div></div> <div class="vibe-score-interpretation svelte-13l5hib"><div class="interpretation-emoji svelte-13l5hib"> </div> <div class="interpretation-text svelte-13l5hib"> </div></div></div></div> <div class="breathing-guide-section svelte-13l5hib"><h3 class="mb-3 text-xl font-semibold svelte-13l5hib">Breathing Guide</h3> <p class="mb-3 text-sm text-gray-500 svelte-13l5hib">Follow the rhythm</p> <div class="breathing-guide-container svelte-13l5hib"><div class="breathing-pulse-ring svelte-13l5hib"></div> <div><div class="breathing-text svelte-13l5hib"> </div> <div class="breathing-timer svelte-13l5hib"> </div></div> <div class="breathing-ripple svelte-13l5hib"></div></div></div> <div class="button-container svelte-13l5hib"><button class="stop-button svelte-13l5hib">Stop Session</button></div></div>'),ya=N('<div class="error-message svelte-13l5hib"> </div>'),Da=N('<div class="modal-overlay svelte-13l5hib"><div class="summary-modal svelte-13l5hib"><h2 class="svelte-13l5hib">Session Summary</h2> <div class="summary-stats svelte-13l5hib"><div class="summary-stat svelte-13l5hib"><span class="stat-label svelte-13l5hib">Duration</span> <span class="stat-value svelte-13l5hib"> </span></div> <div class="summary-stat svelte-13l5hib"><span class="stat-label svelte-13l5hib">Avg Heart Rate</span> <span class="stat-value svelte-13l5hib"> </span></div> <div class="summary-stat svelte-13l5hib"><span class="stat-label svelte-13l5hib">Avg Balance (RMSSD)</span> <span class="stat-value svelte-13l5hib"> </span></div> <div class="summary-stat svelte-13l5hib"><span class="stat-label svelte-13l5hib">Vibe Score</span> <span class="stat-value svelte-13l5hib"> </span></div></div> <!> <div class="summary-actions svelte-13l5hib"><button class="save-button svelte-13l5hib"><!></button> <button class="discard-button svelte-13l5hib">Discard Session</button></div></div></div>'),xa=N('<div class="hrv-session-container svelte-13l5hib"><h1 class="svelte-13l5hib">HRV Session</h1> <!> <!></div> <!>',1);function qa(c,r){Qt(r,!1);const[i,m]=ra(),n=()=>Se(De,"$hrvData",i),p=()=>Se(q,"$sessionTimer",i),w=()=>Se(oa,"$authStore",i),S=()=>Se(V,"$bleConnectionStatus",i);let D=T(),b=null,C=T("inhale"),ee=T(0),P=null,A=T(!1),z=T(!1),y=T(null),W=T(null),te=T(null),ae=T(!1),ne=T(!1),M=T({hr:"-",rmssd:"-",vibe:"-"}),xe=T(We(0)),I=T(null);const f={heartRate:{title:"Heart Rate",explanation:"Your heart beats per minute.",hint:"Normal resting range is 60-100 BPM.",stateDescription:"Lower heart rate during rest often indicates better cardiovascular health.",suggestion:"Focus on your breath to help regulate your heart rate."},balance:{title:"Balance",explanation:"Your nervous system is relaxing between beats.",hint:"Measured in milliseconds of variation between heartbeats.",stateDescription:"Higher = more emotional flexibility and calm.",suggestion:"Keep breathing gently – this is a good sign."},vibeScore:{title:"Vibe Score",explanation:"A measure of your overall physiological balance.",hint:"Combines heart rate variability, breathing patterns, and rhythm.",stateDescription:"Higher scores reflect a state of calm awareness and inner balance.",suggestion:"Notice what helps your score rise and fall."},time:{title:"Session Time",explanation:"Duration of your current session.",hint:"",stateDescription:"Even short sessions of 3-5 minutes can be beneficial.",suggestion:"Try to practice regularly rather than focusing on length."}};async function oe(o){await ta(),requestAnimationFrame(()=>{e(I)===o?h(I,null):h(I,o)})}function Xe(){if(!e(D))return console.error("Chart element not found"),null;console.log("Initializing chart with element:",e(D));const o={width:e(D).clientWidth,height:240,padding:[20,0,0,0],cursor:{show:!0,points:{show:!1},drag:{setScale:!1},focus:{prox:30},dataIdx:(u,v,d)=>{if(d!==null){const l=u.data;h(M,{hr:l[1][d]!==null?l[1][d].toFixed(0)+" bpm":"-",rmssd:l[2][d]!==null?l[2][d].toFixed(1)+" ms":"-",vibe:l[3][d]!==null?l[3][d].toFixed(0):"-"})}return d}},legend:{show:!1},series:[{},{scale:"hr",label:"Heart Rate",value:(u,v)=>v==null?"-":v.toFixed(0)+" bpm",stroke:"rgba(229, 57, 53, 0.8)",width:2,points:{show:!1},spanGaps:!0},{scale:"rmssd",label:"Balance",value:(u,v)=>v==null?"-":v.toFixed(1)+" ms",stroke:"rgba(77, 68, 179, 0.8)",width:2,points:{show:!1},spanGaps:!0},{scale:"vibe",label:"Vibe Score",value:(u,v)=>v==null?"-":v.toFixed(0),stroke:"rgba(191, 70, 154, 0.8)",width:2,points:{show:!1},spanGaps:!0}],scales:{x:{time:!0,auto:!1,range:(u,v,d)=>{const l=Date.now()/1e3;return[l-120,l]}},hr:{auto:!0,range:[40,180]},rmssd:{auto:!0,range:[0,100]},vibe:{auto:!0,range:[0,100]}},axes:[]};try{console.log("Creating uPlot instance with options:",o),b=new da(o,[[],[],[],[]],e(D)),console.log("Chart created successfully:",b),b&&b.hooks&&b.hooks.setData&&b.hooks.setData.push(()=>{var u,v,d;if(b){const l=b.data[0].length-1;l>=0&&h(M,{hr:b.data[1][l]!==null?(((u=b.data[1][l])==null?void 0:u.toString())||"-")+" bpm":"-",rmssd:b.data[2][l]!==null?(((v=b.data[2][l])==null?void 0:v.toString())||"-")+" ms":"-",vibe:b.data[3][l]!==null&&((d=b.data[3][l])==null?void 0:d.toString())||"-"})}})}catch(u){return console.error("Error creating chart:",u),null}const g=new ResizeObserver(u=>{b&&u[0]&&b.setSize({width:u[0].contentRect.width,height:240})});return g.observe(e(D)),()=>{b&&(b.destroy(),b=null),g.disconnect()}}function wt(){if(!b)if(console.warn("Cannot update chart: chart instance is null"),e(D)&&!b){if(console.log("Attempting to reinitialize chart..."),Xe(),!b)return}else return;const o=n().chartData;if(o.length===0){console.log("No chart data available yet");return}console.log("Updating chart with data points:",o.length);const g=o.map(l=>new Date(l.timestamp).getTime()/1e3),u=o.map(l=>l.hr),v=o.map(l=>l.rmssd),d=o.map(l=>l.vibe);try{b.setData([g,u,v,d]),console.log("Chart updated successfully")}catch(l){console.error("Error updating chart:",l)}}function yt(){let v="inhale",d=0,l=Date.now();P=setInterval(()=>{const L=Date.now(),x=L-l;l=L,v==="inhale"?(d+=x/4e3*100,d>=100&&(d=0,v="exhale")):(d+=x/6e3*100,d>=100&&(d=0,v="inhale")),h(C,v),h(ee,d)},16)}function Ze(){P&&(clearInterval(P),P=null)}async function Dt(){var o;if(h(W,null),!je()){h(W,"Bluetooth is not supported on this device. Please use a device with Bluetooth support.");return}try{const g=await ha();g.success?(p().isRunning||St(),yt(),Ye(),h(A,!0)):h(W,((o=g.error)==null?void 0:o.message)||"Failed to connect to device.")}catch(g){console.error("Error starting session:",g),h(W,g instanceof Error?g.message:"An unknown error occurred.")}}async function xt(){if(!(!w().user||!e(y))){h(ae,!0),h(te,null);try{const o={timestamp:new Date().toISOString(),start:e(y).startTime,end:e(y).endTime,duration_seconds:e(y).durationSeconds,avg_hr:e(y).avgHR,avg_rmssd:e(y).avgRMSSD,vibe_score:e(y).avgVibe,vibe_interpretation:e(y).vibeInterpretation,chart_data:e(y).chartData,rr_intervals:e(y).rrIntervals};if((await ua(w().user,o)).success)if(h(ne,!0),await ca(w().user)){const v=ft.showRandomTool();v&&await ft.logToolInteraction(w().user,v.id,"shown")}else setTimeout(()=>{Ne("/history")},2e3);else h(te,"Failed to save HRV session. Please try again.")}catch(o){console.error("Error saving HRV session:",o),h(te,"An unexpected error occurred. Please try again.")}finally{h(ae,!1)}}}function Rt(){Qe(),Ze(),h(y,ma()),h(z,!0)}function Et(){Ye(),h(A,!1),h(z,!1),h(y,null),ze(),Ne("/home")}function et(o){const g=Math.floor(o/60),u=o%60;return`${g}:${u.toString().padStart(2,"0")}`}ia(()=>{const o=Xe();return()=>{o==null||o(),Ze(),ze()}}),na(()=>{P&&clearInterval(P),ze()}),mt(()=>n(),()=>{h(xe,We(n().vibeScore))}),mt(()=>n(),()=>{n().chartData.length>0&&(console.log("HRV data updated, chart data points:",n().chartData.length),wt())}),Xt(),sa();var tt=xa(),Re=Zt(tt),at=s(t(Re),2);{var Tt=o=>{var g=Sa(),u=s(t(g),2);{var v=x=>{var B=fa(),k=t(B,!0);a(B),fe(()=>_(k,e(W))),H(x,B)};O(u,x=>{e(W)&&x(v)})}var d=s(u,2),l=s(d,2);{var L=x=>{var B=_a();H(x,B)};O(l,x=>{je()||x(L)})}a(g),U("click",d,Dt),H(o,g)},Ct=o=>{var g=wa(),u=t(g),v=t(u),d=t(v);let l;var L=s(d,2),x=t(L,!0);a(L),a(v);var B=s(v,2),k=t(B);let j;var le=t(k);a(k);var ce=s(k,2),ve=t(ce);a(ce),a(B),a(u);var Y=s(u,2),K=t(Y),J=s(t(K),2),Ee=t(J);me(),a(J);var de=s(J,2);const F=X(()=>e(I)==="heartRate");we(de,{get isVisible(){return e(F)},onClose:()=>h(I,null),get title(){return f.heartRate.title},get explanation(){return f.heartRate.explanation},get hint(){return f.heartRate.hint},get stateDescription(){return f.heartRate.stateDescription},get suggestion(){return f.heartRate.suggestion}}),a(K);var Q=s(K,2),se=s(t(Q),2),Te=t(se);me(),a(se);var ue=s(se,2);const R=X(()=>e(I)==="balance");we(ue,{get isVisible(){return e(R)},onClose:()=>h(I,null),get title(){return f.balance.title},get explanation(){return f.balance.explanation},get hint(){return f.balance.hint},get stateDescription(){return f.balance.stateDescription},get suggestion(){return f.balance.suggestion}}),a(Q);var E=s(Q,2),G=s(t(E),2),Ce=t(G,!0);a(G);var $=s(G,2);const re=X(()=>e(I)==="time");we($,{get isVisible(){return e(re)},onClose:()=>h(I,null),get title(){return f.time.title},get explanation(){return f.time.explanation},get hint(){return f.time.hint},get stateDescription(){return f.time.stateDescription},get suggestion(){return f.time.suggestion}}),a(E);var Ie=s(E,2),Be=s(t(Ie),2),Vt=t(Be,!0);a(Be);var Pt=s(Be,2);const Lt=X(()=>e(I)==="vibeScore");we(Pt,{get isVisible(){return e(Lt)},onClose:()=>h(I,null),get title(){return f.vibeScore.title},get explanation(){return f.vibeScore.explanation},get hint(){return f.vibeScore.hint},get stateDescription(){return f.vibeScore.stateDescription},get suggestion(){return f.vibeScore.suggestion}}),a(Ie),a(Y);var He=s(Y,2),st=s(t(He),2);aa(st,Fe=>h(D,Fe),()=>e(D));var Ve=s(st,2),Pe=t(Ve),he=s(t(Pe),4);let rt;var At=t(he,!0);a(he),a(Pe);var Le=s(Pe,2),be=s(t(Le),4);let it;var Mt=t(be,!0);a(be),a(Le);var nt=s(Le,2),ge=s(t(nt),4);let ot;var kt=t(ge,!0);a(ge),a(nt),a(Ve);var lt=s(Ve,2),Ae=t(lt),ct=t(Ae),Me=s(ct,2),vt=t(Me),$t=t(vt,!0);a(vt),me(2),a(Me),a(Ae);var dt=s(Ae,2),ke=t(dt),Ut=t(ke,!0);a(ke);var ut=s(ke,2),Ft=t(ut,!0);a(ut),a(dt),a(lt),a(He);var $e=s(He,2),ht=s(t($e),4),pe=s(t(ht),2);let bt;var Ue=t(pe),Gt=t(Ue,!0);a(Ue);var gt=s(Ue,2),Ot=t(gt,!0);a(gt),a(pe),me(2),a(ht),a($e);var pt=s($e,2),qt=t(pt);a(pt),a(g),fe((Fe,Nt,zt,Wt,jt,Yt,Kt,Jt)=>{l=Z(d,1,"status-indicator svelte-13l5hib",null,l,Fe),_(x,S().connected?`Connected to Polar H10 ${S().deviceId||""}`:"Disconnected"),j=Z(k,1,"battery-icon svelte-13l5hib",null,j,Nt),_e(le,`width: ${S().batteryLevel??""}%`),_(ve,`${S().batteryLevel??""}%`),_(Ee,`${n().heartRate??""} `),_(Te,`${zt??""} `),_(Ce,Wt),_(Vt,n().vibeScore),rt=Z(he,1,"legend-value svelte-13l5hib",null,rt,jt),_(At,e(M).hr),it=Z(be,1,"legend-value svelte-13l5hib",null,it,Yt),_(Mt,e(M).rmssd),ot=Z(ge,1,"legend-value svelte-13l5hib",null,ot,Kt),_(kt,e(M).vibe),_e(ct,`--intensity: ${n().vibeScore/100}`),_e(Me,`--progress: ${n().vibeScore??""}%`),_($t,n().vibeScore),_(Ut,e(xe).emoji),_(Ft,e(xe).label),bt=Z(pe,1,"breathing-circle svelte-13l5hib",null,bt,Jt),_e(pe,`transform: scale(${e(C)==="inhale"?.4+e(ee)/100*.6:1-e(ee)/100*.8})`),_(Gt,e(C)==="inhale"?"In":"Out"),_(Ot,e(C)==="inhale"?"4s":"6s")},[()=>({connected:S().connected}),()=>({"battery-low":S().batteryLevel<20,"battery-mid":S().batteryLevel>=20&&S().batteryLevel<50,"battery-full":S().batteryLevel>=50}),()=>n().rmssd.toFixed(1),()=>et(p().elapsedSeconds),()=>({"has-value":e(M).hr!=="-"}),()=>({"has-value":e(M).rmssd!=="-"}),()=>({"has-value":e(M).vibe!=="-"}),()=>({inhale:e(C)==="inhale",exhale:e(C)==="exhale"})],X),U("mousedown",K,()=>oe("heartRate")),U("mousedown",Q,()=>oe("balance")),U("mousedown",E,()=>oe("time")),U("mousedown",Ie,()=>oe("vibeScore")),Oe(1,he,()=>qe,()=>({duration:150})),Oe(1,be,()=>qe,()=>({duration:150})),Oe(1,ge,()=>qe,()=>({duration:150})),U("click",qt,Rt),H(o,g)};O(at,o=>{e(A)?o(Ct,!1):o(Tt)})}var It=s(at,2);{var Bt=o=>{var g=Da(),u=t(g),v=s(t(u),2),d=t(v),l=s(t(d),2),L=t(l,!0);a(l),a(d);var x=s(d,2),B=s(t(x),2),k=t(B);a(B),a(x);var j=s(x,2),le=s(t(j),2),ce=t(le);a(le),a(j);var ve=s(j,2),Y=s(t(ve),2),K=t(Y,!0);a(Y),a(ve),a(v);var J=s(v,2);{var Ee=R=>{var E=ya(),G=t(E,!0);a(E),fe(()=>_(G,e(te))),H(R,E)};O(J,R=>{e(te)&&R(Ee)})}var de=s(J,2),F=t(de),Q=t(F);{var se=R=>{var E=Ge("Saving...");H(R,E)},Te=(R,E)=>{{var G=$=>{var re=Ge("Saved!");H($,re)},Ce=$=>{var re=Ge("Save Session");H($,re)};O(R,$=>{e(ne)?$(G):$(Ce,!1)},E)}};O(Q,R=>{e(ae)?R(se):R(Te,!1)})}a(F);var ue=s(F,2);a(de),a(u),a(g),fe((R,E)=>{_(L,R),_(k,`${e(y).avgHR??""} bpm`),_(ce,`${E??""} ms`),_(K,e(y).avgVibe),F.disabled=e(ae)||e(ne),ue.disabled=e(ae)||e(ne)},[()=>et(e(y).durationSeconds),()=>e(y).avgRMSSD.toFixed(1)],X),U("click",F,xt),U("click",ue,Et),H(o,g)};O(It,o=>{e(z)&&e(y)&&o(Bt)})}a(Re);var Ht=s(Re,2);la(Ht,{onClose:()=>Ne("/history")}),H(c,tt),ea(),m()}export{qa as component};
