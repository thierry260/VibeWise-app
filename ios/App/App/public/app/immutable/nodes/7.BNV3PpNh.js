import{t as g,a as w}from"../chunks/DCf4MLEm.js";import"../chunks/Br8XnZlm.js";import{p as De,b as Re,c as s,s as h,m as V,g as e,n as B,r as t,e as l,t as F,d as Q,ac as X}from"../chunks/BtKWLSPg.js";import{e as Ve,s as d}from"../chunks/BG1n1Yyg.js";import{i as H}from"../chunks/grgeRSmy.js";import{b as Be}from"../chunks/BKn3_SA0.js";import{i as Fe}from"../chunks/BYQBo7FT.js";import{s as He,a as Y}from"../chunks/D4asRrhy.js";import{o as je}from"../chunks/RUtFCPZu.js";import{p as Ee}from"../chunks/BTHMLjqK.js";import{g as Z}from"../chunks/U7y0OYIa.js";import{a as Ie}from"../chunks/Cb8aidWk.js";import{d as Le}from"../chunks/BTsfAa0b.js";import{u as Me,g as Te}from"../chunks/D1yjbSCK.js";var $e=g('<div class="loading svelte-wvsm3f">Loading session details...</div>'),ze=g('<div class="error-message svelte-wvsm3f"> </div>'),Ae=g('<div class="interpretation-emoji svelte-wvsm3f"> </div> <div class="interpretation-text svelte-wvsm3f"> </div>',1),Ce=g('<div class="interpretation-emoji svelte-wvsm3f"> </div> <div class="interpretation-text svelte-wvsm3f"> </div>',1),Ge=g('<div class="session-info svelte-wvsm3f"><div class="session-header svelte-wvsm3f"><div class="session-date svelte-wvsm3f"> </div> <div class="session-time svelte-wvsm3f"> </div></div> <div class="stats-grid svelte-wvsm3f"><div class="stat-card svelte-wvsm3f"><div class="stat-label svelte-wvsm3f">Duration</div> <div class="stat-value svelte-wvsm3f"> </div></div> <div class="stat-card svelte-wvsm3f"><div class="stat-label svelte-wvsm3f">Avg Heart Rate</div> <div class="stat-value svelte-wvsm3f"> <span class="unit svelte-wvsm3f">bpm</span></div></div> <div class="stat-card svelte-wvsm3f"><div class="stat-label svelte-wvsm3f">Avg Balance</div> <div class="stat-value svelte-wvsm3f"> <span class="unit svelte-wvsm3f">ms</span></div></div> <div class="vibe-score-card svelte-wvsm3f"><div class="stat-label svelte-wvsm3f">Vibe Score</div> <div class="stat-value svelte-wvsm3f"> </div> <div class="vibe-interpretation svelte-wvsm3f"><!></div></div></div> <div class="chart-section svelte-wvsm3f"><h2 class="svelte-wvsm3f">Session Data</h2> <div class="chart-container svelte-wvsm3f"></div> <div class="chart-legend svelte-wvsm3f"><div class="legend-item svelte-wvsm3f"><div class="legend-dot hr-dot svelte-wvsm3f"></div> <div class="legend-label svelte-wvsm3f">Heart Rate</div></div> <div class="legend-item svelte-wvsm3f"><div class="legend-dot rmssd-dot svelte-wvsm3f"></div> <div class="legend-label svelte-wvsm3f">Balance</div></div> <div class="legend-item svelte-wvsm3f"><div class="legend-dot vibe-dot svelte-wvsm3f"></div> <div class="legend-label svelte-wvsm3f">Vibe Score</div></div></div></div></div>'),Oe=g('<div class="error-message svelte-wvsm3f">Session not found</div>'),Pe=g('<div class="hrv-detail-container svelte-wvsm3f"><div class="header svelte-wvsm3f"><button class="back-button svelte-wvsm3f"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-wvsm3f"><path d="M19 12H5M12 19l-7-7 7-7"></path></svg> Back</button> <h1 class="svelte-wvsm3f">HRV Session Details</h1></div> <!></div>');function is(ee,se){De(se,!1);const[G,te]=He(),O=()=>Y(Ie,"$authStore",G),ae=()=>Y(Ee,"$page",G);let o=V(null),j=V(!0),y=V(null),f=V(),_=null;je(async()=>{if(!O().user){Z("/login");return}const a=ae().url.searchParams.get("id");if(!a){h(y,"No session ID provided."),h(j,!1);return}try{const r=await Le(O().user,a);r.success&&r.session&&r.session.type==="hrv_session"?(h(o,r.session),setTimeout(()=>{e(f)&&e(o)&&ie()},100)):h(y,"Failed to load HRV session or session not found.")}catch(r){console.error("Error loading HRV session:",r),h(y,"An unexpected error occurred while loading the session.")}finally{h(j,!1)}});function ie(){if(!e(f)||!e(o)){console.error("Chart element or session data not found");return}const a=[],r=[],b=[],R=[];e(o).chart_data.forEach(i=>{const v=new Date(i.timestamp).getTime()/1e3;a.push(v),r.push(i.hr),b.push(i.rmssd),R.push(i.vibe)});const c={width:e(f).clientWidth,height:300,padding:[20,0,0,0],cursor:{show:!0,points:{show:!1},drag:{setScale:!1},focus:{prox:30}},legend:{show:!1},series:[{},{scale:"hr",label:"Heart Rate",value:(i,v)=>v==null?"-":v.toFixed(0)+" bpm",stroke:"rgba(229, 57, 53, 0.8)",width:2,points:{show:!1},spanGaps:!0},{scale:"rmssd",label:"Balance",value:(i,v)=>v==null?"-":v.toFixed(1)+" ms",stroke:"rgba(77, 68, 179, 0.8)",width:2,points:{show:!1},spanGaps:!0},{scale:"vibe",label:"Vibe Score",value:(i,v)=>v==null?"-":v.toFixed(0),stroke:"rgba(191, 70, 154, 0.8)",width:2,points:{show:!1},spanGaps:!0}],scales:{x:{time:!0},hr:{auto:!0,range:[40,180]},rmssd:{auto:!0,range:[0,100]},vibe:{auto:!0,range:[0,100]}},axes:[{},{}]};try{_=new Me(c,[a,r,b,R],e(f));const i=new ResizeObserver(v=>{_&&v[0]&&_.setSize({width:v[0].contentRect.width,height:300})});return i.observe(e(f)),()=>{_&&(_.destroy(),_=null),i.disconnect()}}catch(i){console.error("Error creating chart:",i)}}function re(a){return new Date(a).toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric",year:"numeric"})}function ve(a){return new Date(a).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}function oe(a){const r=Math.floor(a/60),b=a%60;return`${r}:${b.toString().padStart(2,"0")}`}function le(){Z("/history")}Fe();var E=Pe(),I=s(E),de=s(I);B(2),t(I);var ne=l(I,2);{var ce=a=>{var r=$e();w(a,r)},me=(a,r)=>{{var b=c=>{var i=ze(),v=s(i,!0);t(i),F(()=>d(v,e(y))),w(c,i)},R=(c,i)=>{{var v=x=>{var D=Ge(),L=s(D),M=s(L),ue=s(M,!0);t(M);var P=l(M,2),pe=s(P,!0);t(P),t(L);var T=l(L,2),$=s(T),U=l(s($),2),we=s(U,!0);t(U),t($);var z=l($,2),q=l(s(z),2),he=s(q);B(),t(q),t(z);var A=l(z,2),N=l(s(A),2),ge=s(N);B(),t(N),t(A);var W=l(A,2),C=l(s(W),2),_e=s(C,!0);t(C);var J=l(C,2),be=s(J);{var xe=n=>{var u=Ae(),m=X(u),p=s(m,!0);t(m);var S=l(m,2),k=s(S,!0);t(S),F(()=>{d(p,e(o).vibe_interpretation.emoji),d(k,e(o).vibe_interpretation.label)}),w(n,u)},Se=n=>{var u=Ce();const m=Q(()=>Te(e(o).vibe_score));var p=X(u),S=s(p,!0);t(p);var k=l(p,2),ye=s(k,!0);t(k),F(()=>{d(S,e(m).emoji),d(ye,e(m).label)}),w(n,u)};H(be,n=>{e(o).vibe_interpretation?n(xe):n(Se,!1)})}t(J),t(W),t(T);var K=l(T,2),ke=l(s(K),2);Be(ke,n=>h(f,n),()=>e(f)),B(2),t(K),t(D),F((n,u,m,p,S,k)=>{d(ue,n),d(pe,u),d(we,m),d(he,`${p??""} `),d(ge,`${S??""} `),d(_e,k)},[()=>re(e(o).timestamp),()=>ve(e(o).timestamp),()=>oe(e(o).duration_seconds),()=>e(o).avg_hr.toFixed(0),()=>e(o).avg_rmssd.toFixed(1),()=>e(o).vibe_score.toFixed(0)],Q),w(x,D)},fe=x=>{var D=Oe();w(x,D)};H(c,x=>{e(o)?x(v):x(fe,!1)},i)}};H(a,c=>{e(y)?c(b):c(R,!1)},r)}};H(ne,a=>{e(j)?a(ce):a(me,!1)})}t(E),Ve("click",de,le),w(ee,E),Re(),te()}export{is as component};
